<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative Ideation Experiment</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        #taskRightside,
        #taskLeftside,
        #gptLeftside,
        #gptRightside {
            width: 48%;
            height: 80vh;
            min-height: 800px;
            display: flex;
            flex-direction: column;
            background-color: #fff;
            border-radius: 12px;
            margin-bottom: 5vh;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            overflow-y: auto;
            overflow-x: hidden
        }

        #gptPage,
        #taskPage {
            display: none;
            width: 98%;
            height: 98vh;
            /* This sets the container to almost full viewport height */
            justify-content: space-around;
            align-items: flex-start;
            /* Change this from center to flex-start */
            padding-bottom: 0vh;
            padding-top: 2vh;
            /* Reduce top padding */
            box-sizing: border-box;
            margin: auto;
            border-radius: 12px;
        }

        #chatbot {
            width: 100%;
            height: 100%;
            /* Make chatbot fill the entire height of its container */
            display: flex;
            flex-direction: column;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        #taskRightside,
        #taskLeftside,
        #gptLeftside {
            text-align: center;
        }

        #errorTask {
            color: #e74c3c;
            display: none;
            font-size: 14px;
            width: 100%;
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
        }

        #aut-container {
            width: 70%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 5vh;
            padding: 20px;
            box-sizing: border-box;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #chatbot>p {
            background-color: #3498db;
            color: #fff;
            margin: 0;
            padding: 15px;
            display: flex;
            align-items: center;
            font-weight: bold;
            border-radius: 12px 12px 0 0;
        }

        #taskInstructions,
        #gptInstructions,
        #gptTask,
        #ageAttention {
            padding: 20px;
            width: calc(100% - 60px);
            margin: 10px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            overflow-y: auto;
            border-radius: 8px;
            user-select: none;
            flex-grow: 1;
            text-align: left;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        #autTask {
            padding: 20px;
            width: calc(100% - 60px);
            margin: 10px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            overflow-y: auto;
            border-radius: 8px;
            user-select: none;
            flex-grow: 1;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        #gptInstructions {
            height: 20%;
        }

        #chatDisplayGptPage,
        #chatDisplayTask {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            height: 80%;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            display: flex;
            flex-direction: column;
            font-size: 14px;
            text-align: left;
        }

        #inputContainer {
            display: flex;
            align-items: center;
            background-color: #f5f5f5;
            border-top: 1px solid #e0e0e0;
            padding: 10px;
            border-radius: 0 0 12px 12px;
            margin-top: auto;
        }

        #chatbotInputGptPage,
        #chatbotInputTask {
            flex-grow: 1;
            margin: 0;
            border: none;
            background-color: #fff;
            color: #333;
            font-size: 14px;
            padding: 12px 16px;
            border-radius: 20px;
            resize: none;
            height: 56px;
            min-height: 56px;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }

        #chatbotInputGptPage:focus,
        #chatbotInputTask:focus {
            outline: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        #chatbotInputGptPage::placeholder,
        #chatbotInputTask::placeholder {
            color: #aaa;
        }

        #sendGptPage,
        #sendTask,
        #imageGptPage,
        #imageTask {
            width: 40px;
            height: 40px;
            background-color: #3498db;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 8px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        #sendGptPage:hover,
        #sendTask:hover,
        #imageGptPage:hover,
        #imageTask:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }

        .send-icon,
        .image-icon {
            width: 20px;
            height: 20px;
            fill: #fff;
        }

        #namearea,
        #reasonarea,
        #nameAreaGPT,
        #reasonAreaGPT {
            width: calc(100% - 20px);
            margin: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            resize: none;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #namearea:focus,
        #reasonarea:focus,
        #nameAreaGPT:focus,
        #reasonAreaGPT:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        #nameAreaGPT {
            height: 10%;
        }

        #reasonAreaGPT {
            height: 40%;
        }

        #namearea {
            height: 6%;
        }

        #reasonarea {
            height: 10%;
        }

        .message {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            max-width: 80%;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user {
            align-self: flex-end;
            background-color: #e1f5fe;
            border: 1px solid #b3e5fc;
        }

        .bot {
            align-self: flex-start;
            background-color: #f1f8e9;
            border: 1px solid #dcedc8;
        }

        .bot img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-icon {
            margin-right: 10px;
            height: 24px;
        }

        #readyButton,
        #submitButton,
        #go2SurveyPage,
        #go2AgePage,
        #autButton,
        #taskButton,
        #go2BeforeTaskPage {
            background-color: #2ecc71;
            color: #ffffff;
            font-weight: bold;
            border-radius: 25px;
            padding: 12px 30px;
            margin-top: 20px;
            cursor: pointer;
            border: none;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #go2SurveyPage,
        #go2AgePage,
        #go2BeforeTaskPage {
            width: calc(100% - 20px);
            margin: 10px;
        }

        #readyButton:hover,
        #submitButton:hover,
        #go2SurveyPage:hover,
        #autButton:hover,
        #taskButton:hover,
        #go2AgePage:hover,
        #go2BeforeTaskPage:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        #welcomePage,
        #gptPage,
        #agePage,
        #autPage,
        #beforeTaskPage,
        #taskPage,
        #surveyPage,
        #endPage {
            display: none;
            width: 98%;
            height: 98%;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 0vh;
            padding-top: 5vh;
            box-sizing: border-box;
            margin: auto;
            border-radius: 12px;
        }

        #welcomePage {
            display: flex;
            flex-direction: column;
        }

        #readyButton:disabled,
        #autButton:disabled,
        #taskButton:disabled {
            background-color: #bdc3c7;
            color: #7f8c8d;
            cursor: not-allowed;
            box-shadow: none;
        }

        .word-count {
            padding: 5px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .wordCount {
            margin-top: 5px;
            font-size: 12px;
            color: #7f8c8d;
            align-self: flex-end;
            width: 90%;
        }

        #taskInstructions img.product-image {
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        #modal {
            background: rgba(0, 0, 0, 0.7);
        }

        #modal>div {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        #closeModal {
            background-color: #3498db;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        #closeModal:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        #ageInput {
            width: calc(100% - 20px);
            margin: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        #ageInput:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .autAnswer {
            width: calc(100% - 20px);
            margin: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            resize: none;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .autAnswer:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        #addAnswerButtonContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }

        #addAnswerButtonContainer span {
            font-size: 14px;
            color: #7f8c8d;
        }

        #addAnswerButton {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        #addAnswerButton:hover {
            background-color: #2980b9;
            transform: scale(1.1);
        }

        #ageAttention,
        #autTask {
            text-align: center;
            font-size: 18px;
            line-height: 1.6;
        }

        #ageInput {
            font-size: 16px;
            width: 100px;
            text-align: center;
            margin: 20px auto;
            display: block;
        }

        #autAnswers {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .autAnswer {
            width: 80%;
            margin: 10px auto;
        }

        #ideasContainer {
            max-height: 400px;
            padding: 20px;
            width: calc(100% - 60px);
            margin: 10px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            overflow-y: auto;
            border-radius: 8px;
            user-select: none;
            flex-grow: 1;
            align-items: center;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .ideaContainer {
            margin-bottom: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .ideaContainer:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .reasonarea {
            width: 90%;
            height: 80px;
            min-height: 80px;
            max-height: 80px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            resize: none;
            overflow-y: auto;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .reasonarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .wordCount {
            margin-top: 5px;
            font-size: 12px;
            color: #7f8c8d;
            text-align: right;
        }

        #addIdeaButtonContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0px;
            gap: 10px;
        }

        #addIdeaButtonContainer span {
            font-size: 14px;
            color: #7f8c8d;
        }

        #addIdeaButton {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        #addIdeaButton:hover {
            background-color: #2980b9;
            transform: scale(1.1);
        }

        #go2SurveyPage:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }

        #addIdeaError {
            color: #e74c3c;
            height: 50%;
            margin-top: auto;
            font-size: 12px;
            text-align: center;
        }

        #errorTaskContainer {
            height: 20px;
            margin-top: 5px;
            overflow: hidden;
        }

        #errorTask {
            color: #e74c3c;
            font-size: 12px;
            line-height: 20px;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .radio-option {
            flex-basis: 14%;
            margin-bottom: 10px;
            text-align: center;
        }

        @media (max-width: 480px) {
            .radio-option {
                flex-basis: 25%;
            }
        }

        @media (max-width: 480px) {
            .radio-option {
                flex-basis: 33%;
            }
        }

        #surveyPage {
            flex-direction: column;
            align-items: center;
            height: 100vh;
            /* Full viewport height */
            padding: 20px;
            box-sizing: border-box;
        }

        #surveyForm {
            width: 60%;
            max-height: 70vh;
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            margin-top: 10px;
        }

        #surveyTitle {
            text-align: center;
            color: #333;
            margin-top: 20px;
        }

        #errorSurveyContainer {
            width: 40%;
            height: 100px;
            margin-top: 10px;
            border: 1px solid #e74c3c;
            border-radius: 5px;
            overflow-y: auto;
        }

        #surveyButton {
            width: 80%;
            max-width: 600px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            text-align: center;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            max-width: 300px;
            padding: 0.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            text-align: center;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23555' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 12px;
            padding-right: 2rem;
        }


        #errorSurvey {
            color: #e74c3c;
            padding: 10px;
            font-size: 12px;
        }

        #submitButton {
            display: inline-block;
            width: 100%;
            max-width: 300px;
            padding: 0.75rem;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #submitButton:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        .birthday-inputs {
            display: flex;
            gap: 10px;
            font-size: 14px;
        }

        .birthday-inputs input {
            width: 80px;
            font-size: 14px;
        }

        .recall-inputs {
            display: flex;
            gap: 10px;
            font-size: 14px;
        }

        .recall-inputs input {
            width: 200px;
            font-size: 14px;
        }

        .idea-ratings {
            margin-top: 20px;
        }

        .idea-rating-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            padding: 15px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .idea-rating-row:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .idea-column,
        .ratings-column {
            padding: 10px;
        }

        .idea-column {
            flex: 1 1 300px;
            min-width: 300px;
        }

        .ratings-column {
            flex: 2 1 400px;
        }

        .idea-column h4 {
            margin-top: 0;
            color: #3498db;
        }

        .rating-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
        }

        .range-label {
            flex: 0 0 100px;
            font-size: 12px;
            white-space: nowrap;
        }

        .range-label.left {
            text-align: right;
            padding-right: 10px;
        }

        .range-label.right {
            text-align: left;
            padding-left: 10px;
        }

        .rating-row input[type="range"] {
            flex: 1;
            margin: 0 10px;
            -webkit-appearance: none;
            width: 100%;
            height: 5px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            transition: background 0.3s ease;
        }

        .rating-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .rating-row input[type="range"]::-webkit-slider-thumb:hover {
            background: #2980b9;
            transform: scale(1.1);
        }

        .range-value {
            flex: 0 0 20px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            color: #3498db;
        }

        @media (max-width: 768px) {
            .idea-rating-row {
                flex-direction: column;
            }

            .idea-column,
            .ratings-column {
                width: 100%;
            }

            .rating-row {
                flex-wrap: wrap;
            }

            .range-label {
                flex: 1 0 100%;
                text-align: center;
                margin-bottom: 5px;
            }

            .rating-row input[type="range"] {
                flex: 1 0 100%;
                margin: 10px 0;
            }

            .range-value {
                flex: 1 0 100%;
                text-align: center;
                margin-top: 5px;
            }
        }

        #errorContainer {
            height: 40px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #errorGPT {
            color: #e74c3c;
            font-size: 12px;
            text-align: center;
            max-width: 80%;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div id="welcomePage">
        <div style="max-width: 600px; text-align: center;">
            <h1 style="font-size: 28px; margin-bottom: 20px; color: #3498db;"><strong>Welcome to the
                    Experiment!</strong></h1>
            <div style="padding: 20px; border: 2px solid #3498db; border-radius: 12px; background-color: #f9f9f9;">
                <ul style="list-style-type: none; padding: 0;">
                    <li style="margin-bottom: 15px; text-align: left;">
                        <span style="color: #e74c3c; font-weight: bold;">✓ Full-Screen Mode:</span> The following
                        session will be conducted in full-screen mode. Please AVOID exiting full-screen mode, as doing
                        so will end the session prematurely.
                    </li>
                    <li style="margin-bottom: 15px; text-align: left;">
                        <span style="color: #e74c3c; font-weight: bold;">✓ Time Commitment:</span> The experiment
                        consists of three tasks and one survey, with an expected duration of 10 minutes. Please
                        allocate sufficient time to complete all components without interruption.
                    </li>
                    <li style="margin-bottom: 15px; text-align: left;">
                        <span style="color: #e74c3c; font-weight: bold;">✓ Task Instructions:</span> Read all
                        instructions carefully before beginning each task.
                    </li>
                </ul>
            </div>
            <button id="readyButton">Getting Ready...</button>
            <div id="uniqueIndexDisplay"
                style="position: fixed; bottom: 10px; right: 10px; color: #bdc3c7; font-size: 12px; display :block">
            </div>
        </div>
    </div>

    <div id="gptPage">
        <div id=gptLeftside>
            <div id="chatbot">
                <p><strong>AI Assistant</strong></p>
                <div id="chatDisplayGptPage"></div>
                <div id="inputContainer">
                    <textarea id="chatbotInputGptPage" placeholder="Type your message here..."></textarea>
                    <button id="sendGptPage">
                        <svg class="send-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                        </svg>
                    </button>
                    <button id="imageGptPage">
                        <svg class="image-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="gptRightside">
            <div id="gptInstructions">
                <ul style="padding: 0; padding-left: 20px; text-align: left;">
                    <li style="margin-bottom: 10px;">Generative AI is a technology that can generate text, images, or
                        videos based on textual prompts. The AI Assistant shown in the left panel is a generative AI
                        product.
                    </li>
                    <li style="margin-bottom: 10px;"> You can pose questions to facilitate the process of ideation. To
                        get the best results, providing clear, detailed, and contextually rich prompts
                        is key.
                        <ul style="list-style-type: circle; margin-top: 10px;">
                            <li style="margin-bottom: 10px;">Click
                                <svg class="send-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; vertical-align: middle; fill: currentColor;">
                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                                </svg>
                                if you want the AI Assistant to generate textual responses.
                            </li>
                            <li style="margin-bottom: 10px;">Click
                                <svg class="image-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; vertical-align: middle; fill: currentColor;">
                                    <path
                                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z">
                                    </path>
                                </svg>
                                if you want the AI Assistant to generate images.
                            </li>
                        </ul>
                    </li>
                    <li style="margin-bottom: 10px;"> The following practices are designed to help you get familiar with
                        the AI Assistant and the overall task. Your responses here will <span
                            style="margin-bottom: 10px; color: #e74c3c;font-weight: bold;">NOT </span>be evaluated.
                    </li>
                </ul>
            </div>
            <div id="gptTask">
                <ul style="padding: 0; padding-left: 20px; text-align: left;">
                    <li style="margin-bottom: 10px;"><span
                            style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">PRACTICE
                            1:</span> Please send at least <span
                            style="margin-bottom: 10px; color: #e74c3c;font-weight: bold;"> one message for a textual
                            response and one message for an image response </span> to the AI Assistant.
                        Please let it help you finish the task below.
                    </li>
                    <li style="margin-bottom: 10px;"> <span
                            style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">PRACTICE
                            2:</span> Please design <span style="color: #e74c3c; font-weight: bold;"> a
                            daily necessity by combining these two concepts: spoon and fork</span>. Please give a
                        description for
                        your idea with at least 20 words.</li>
                </ul>
                <textarea id="reasonAreaGPT" placeholder="Enter an idea here..."></textarea>
                <div id="wordCountGPT" class="word-count">Word Count: 0</div>
            </div>
            <div id="errorContainer" style="height: 40px; margin-top: 10px;">
                <span id="errorGPT" style="color: #e74c3c; display: none; font-size: 12px;"></span>
            </div>
            <button id="go2AgePage" disabled>Next</button>
        </div>
    </div>

    <div id="agePage">
        <div style="max-width: 600px; text-align: center;">
            <h1 style="font-size: 24px; margin-bottom: 20px; color: #3498db;"><strong>TASK 2: Alternative Uses
                    Test</strong></h1>
            <div style="padding: 20px; border: 2px solid #3498db; border-radius: 12px; background-color: #f9f9f9;">
                <p style="margin-bottom: 20px;">Before we proceed, please provide your age.</p>
                <input type="number" id="ageInput" placeholder="Age" min="1" max="120"
                    style="font-size: 16px; width: 100px; text-align: center; margin: 0 auto 20px; display: block; padding: 10px; border: 1px solid #3498db; border-radius: 8px;">
                <p style="margin-bottom: 15px; text-align: left;">✓ In the next page, you will complete a test by
                    <span style="color: #e74c3c; font-weight: bold;"> listing novel uses for a paper clip</span> in
                    <span style="color: #e74c3c; font-weight: bold;"> 2 minutes</span>.
                </p>
                <p style="margin-bottom: 15px; text-align: left;">! The countdown will <span
                        style="color: #e74c3c; font-weight: bold;">start immediately</span> after you press
                    the "I am ready" button.</p>
            </div>
            <button id="autButton" disabled style="margin-top: 20px;">Getting Ready...</button>
        </div>
    </div>

    <div id="autPage">
        <div id="aut-container">
            <div id="autCountdown"
                style="text-align:center; font-size:24px; margin-top:10px; font-weight: bold; color: #3498db;">Time
                left: 02:00</div>
            <div id="autTask">
                <p>
                    <li style="margin-bottom: 10px;"> <span
                            style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">TASK:</span>
                        Please
                        list novel uses for <span style="color: #e74c3c; font-weight: bold;"> a paper clip</span> as
                        many as
                        possible in <span style="color: #e74c3c; font-weight: bold;">2 minutes</span>.
                </p>
                <div id="autAnswers">
                    <textarea class="autAnswer" placeholder="Enter a novel use for a paper clip"></textarea>
                </div>
            </div>
            <div id="addAnswerButtonContainer">
                <span>Click "+" button and scroll down to add more uses</span>
                <button id="addAnswerButton">+</button>
            </div>
        </div>
    </div>

    <div id="beforeTaskPage">
        <div style="max-width: 700px; text-align: center;">
            <h1 style="font-size: 24px; margin-bottom: 20px; color: #3498db;"><strong>FINAL TASK: Creative Ideation
                </strong></h1>
            <div style="padding: 20px; border: 2px solid #3498db; border-radius: 12px; background-color: #f9f9f9;">
                <ul style="list-style-type: none; padding: 0;">
                    <li style="margin-bottom: 15px; text-align: left;"><span
                            style="color: #e74c3c; font-weight: bold;">✓ Unlimited Time:</span> You have unlimited time
                        to complete this task. The minimum time required for this task is five minutes.</li>
                    <li style="margin-bottom: 15px; text-align: left;"><span
                            style="color: #e74c3c; font-weight: bold;">✓ At Least Three Ideas:</span> Please generate at
                        least three ideas. Feel free to be as creative as possible and submit your answers once you
                        are satisfied. </li>
                    <li style="margin-bottom: 15px; text-align: left;"><span
                            style="color: #e74c3c; font-weight: bold;">$ Basic Payment:</span> Complete the task to
                        receive a base compensation of $5. </li>
                    <li style="margin-bottom: 15px; text-align: left;"><span
                            style="color: #e74c3c; font-weight: bold;">$ Additional Bonus:</span> Your ideas will be
                        rated by human professionals. If any of your ideas rank in the top 20% for novelty, you will
                        receive an additional $3 bonus. If any of your ideas rank between the top 20% and 50% for
                        novelty, you will receive an additional $2 bonus. </li>
                    <!-- The "No Generative AI Tools" list item will be dynamically added or removed here -->
                </ul>
            </div>
            <button id="taskButton" disabled style="margin-top: 20px;">Getting Ready...</button>
        </div>
    </div>

    <div id="taskPage">
        <div id="taskLeftside">
            <div id="chatbot">
                <p><strong>AI Assistant</strong></p>
                <div id="chatDisplayTask"></div>
                <div id="inputContainer">
                    <textarea id="chatbotInputTask" placeholder="Type your message here..."></textarea>
                    <button id="sendTask">
                        <svg class="send-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                        </svg>
                    </button>
                    <button id="imageTask">
                        <svg class="image-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="taskRightside">
            <div id="taskInstructions">
                <!--Dynamic generation -->
            </div>
            <div id="ideasContainer">
                <div id="ideaInputs">
                    <div class="ideaContainer">
                        <textarea class="reasonarea" placeholder="Enter an idea here..."></textarea>
                        <div class="wordCount">Word Count: 0</div>
                    </div>
                    <div class="ideaContainer">
                        <textarea class="reasonarea" placeholder="Enter an idea here..."></textarea>
                        <div class="wordCount">Word Count: 0</div>
                    </div>
                    <div class="ideaContainer">
                        <textarea class="reasonarea" placeholder="Enter an idea here..."></textarea>
                        <div class="wordCount">Word Count: 0</div>
                    </div>
                </div>
            </div>
            <div id="addIdeaButtonContainer">
                <span>Click "+" button and scroll down to add more ideas</span>
                <button id="addIdeaButton">+</button>
            </div>
            <div id="errorContainer"
                style="min-height: 50px; margin-top: 10px; display: flex; flex-direction: column; justify-content: center;">
                <div id="errorTaskContainer"
                    style="min-height: 25px; display: flex; align-items: center; justify-content: center;">
                    <span id="errorTask"
                        style="color: #e74c3c; display: none; font-size: 12px; text-align: center;">Please submit at
                        least three ideas with at least 20 words for each idea.</span>
                </div>
                <div id="addIdeaError"
                    style="min-height: 25px; display: flex; align-items: center; justify-content: center; color: #e74c3c; font-size: 12px; text-align: center;">
                </div>
            </div>
            <button id="go2SurveyPage" disabled>Submit</button>
        </div>
    </div>

    <div id="surveyPage">
        <div id="surveyTitle">
            <h2 style="color: #3498db;">Survey</h2>
        </div>
        <form id="surveyForm">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="text" id="email" name="email" placeholder="Enter your email" required>
            </div>

            <div class="form-group">
                <label for="birthday">Birthday:</label>
                <div class="birthday-inputs">
                    <input type="number" id="birthdayYear" name="birthdayYear" placeholder="Year" required min="1900"
                        max="2024">
                    <input type="number" id="birthdayMonth" name="birthdayMonth" placeholder="Month" required min="1"
                        max="12">
                    <input type="number" id="birthdayDay" name="birthdayDay" placeholder="Day" required min="1"
                        max="31">
                </div>
            </div>

            <div class="form-group">
                <label for="gender">Gender:</label>
                <select id="gender" name="gender" required>
                    <option value="">Select your gender</option>
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                    <option value="other">Other</option>
                    <option value="prefer_not_to_say">Prefer not to say</option>
                </select>
            </div>

            <div class="form-group">
                <label for="education">Education:</label>
                <select id="education" name="education" required>
                    <option value="">Select your education level</option>
                    <option value="doctorate">Doctorate Degree</option>
                    <option value="professional">Professional Degree</option>
                    <option value="masters">Master's Degree</option>
                    <option value="bachelors">Bachelor's Degree</option>
                    <option value="high_school">High School or Equivalent</option>
                    <option value="less_than_high_school">Less than High School</option>
                </select>
            </div>

            <div class="form-group">
                <label for="english_proficiency">English Proficiency:</label>
                <select id="english_proficiency" name="english_proficiency" required>
                    <option value="">Select your English proficiency level</option>
                    <option value="native">Native or Bilingual</option>
                    <option value="full_professional">Full Professional</option>
                    <option value="professional_working">Professional Working</option>
                    <option value="limited_working">Limited Working</option>
                    <option value="elementary">Elementary Proficiency</option>
                    <option value="no_proficiency">No Proficiency</option>
                </select>
            </div>

            <div class="form-group">
                <label for="race">Race:</label>
                <select id="race" name="race" required>
                    <option value="">Select your race</option>
                    <option value="african_american">African American</option>
                    <option value="asian">Asian</option>
                    <option value="american_indian">American Indian/Alaska Native</option>
                    <option value="hispanic">Hispanic or Latino</option>
                    <option value="white">White or Caucasian</option>
                    <option value="native_hawaiian">Native Hawaiian/Pacific Islander</option>
                    <option value="other">Others</option>
                </select>
            </div>

            <div class="form-group">
                <label for="employment_status">Employment Status:</label>
                <select id="employment_status" name="employment_status" required>
                    <option value="">Select your employment status</option>
                    <option value="student">Student</option>
                    <option value="employee">Employee</option>
                    <option value="unemployed">Unemployed</option>
                    <option value="retired">Retired</option>
                </select>
            </div>

            <div class="form-group">
                <label for="work_experience">Work Experience:</label>
                <input type="number" id="work_experience" name="work_experience" placeholder="Years" required>
            </div>

            <div class="form-group">
                <label for="recall">What were the two concepts you just combined to create your toy design?</label>
                <div class="recall-inputs">
                    <input type="text" id="recall-word1" name="recall-word1" placeholder="Word 1" required>
                    <input type="text" id="recall-word2" name="recall-word2" placeholder="Word 2" required>
                </div>
            </div>

            <div class="form-group">
                <label for="creative_selfbelief">In general, how creative do you consider yourself?</label>
                <select id="creative_selfbelief" name="creative_selfbelief" required>
                    <option value="">Select your creativity level</option>
                    <option value="1">1 - Not at all creative</option>
                    <option value="2">2 - Slightly creative</option>
                    <option value="3">3 - Somewhat creative</option>
                    <option value="4">4 - Moderately creative</option>
                    <option value="5">5 - Very creative</option>
                    <option value="6">6 - Highly creative</option>
                    <option value="7">7 - Extremely creative</option>
                </select>
            </div>

            <div class="form-group">
                <label for="task_familiarity">How frequently do you perform tasks similar to the one you just did in
                    your daily life?</label>
                <select id="task_familiarity" name="task_familiarity" required>
                    <option value="">Select frequency</option>
                    <option value="every_day">Every day</option>
                    <option value="few_times_week">A few times a week</option>
                    <option value="once_week">Once a week</option>
                    <option value="2_3_times_month">2-3 times a month</option>
                    <option value="once_month">Once a month</option>
                    <option value="less_than_once_month">Less than once a month</option>
                    <option value="never">Never</option>
                </select>
            </div>

            <div class="form-group">
                <label for="genai_familiarity">How frequently do you use generative AI tools (such as ChatGPT) in your
                    daily life?</label>
                <select id="genai_familiarity" name="genai_familiarity" required>
                    <option value="">Select frequency</option>
                    <option value="every_day">Every day</option>
                    <option value="few_times_week">A few times a week</option>
                    <option value="once_week">Once a week</option>
                    <option value="2_3_times_month">2-3 times a month</option>
                    <option value="once_month">Once a month</option>
                    <option value="less_than_once_month">Less than once a month</option>
                    <option value="never">Never</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_human_disease">How much would you trust a human doctor for diagnosing a
                    disease?</label>
                <select id="algorithm_trust_human_disease" name="algorithm_trust_human_disease" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_ai_disease">How much would you trust an algorithm for diagnosing a
                    disease?</label>
                <select id="algorithm_trust_ai_disease" name="algorithm_trust_ai_disease" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_human_music">How much would you trust a human composer for composing a
                    song?</label>
                <select id="algorithm_trust_human_music" name="algorithm_trust_human_music" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_ai_music">How much would you trust an algorithm for composing a
                    song?</label>
                <select id="algorithm_trust_ai_music" name="algorithm_trust_ai_music" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="gpt_speed_comparison">How much faster did you complete the task compared to how long it
                    would have taken without generative AI tools?</label>
                <select id="gpt_speed_comparison" name="gpt_speed_comparison" required>
                    <option value="">Select your answer</option>
                    <option value="1">1 - Much slower</option>
                    <option value="2">2 - Slower</option>
                    <option value="3">3 - Slightly slower</option>
                    <option value="4">4 - About the same speed</option>
                    <option value="5">5 - Faster</option>
                    <option value="6">6 - Much faster</option>
                    <option value="7">7 - Extremely faster</option>
                </select>
            </div>

            <div class="form-group">
                <label for="gpt_novelty_comparison">How much better in idea novelty did you complete the ideation task
                    compared to how this task would have been without generative AI tools?</label>
                <select id="gpt_novelty_comparison" name="gpt_novelty_comparison" required>
                    <option value="">Select your answer</option>
                    <option value="1">1 - Much less novel</option>
                    <option value="2">2 - Less novel</option>
                    <option value="3">3 - Slightly less novel</option>
                    <option value="4">4 - About the same novelty</option>
                    <option value="5">5 - More novel</option>
                    <option value="6">6 - Much more novel</option>
                    <option value="7">7 - Extremely more novel</option>
                </select>
            </div>

            <div class="form-group">
                <label for="creative_confidence">In the toy design task, how confident are you in your ability to solve
                    the problem creatively?</label>
                <select id="creative_confidence" name="creative_confidence" required>
                    <option value="">Select your confidence level</option>
                    <option value="1">1 - Not at all confident</option>
                    <option value="2">2 - Slightly confident</option>
                    <option value="3">3 - Somewhat confident</option>
                    <option value="4">4 - Moderately confident</option>
                    <option value="5">5 - Very confident</option>
                    <option value="6">6 - Highly confident</option>
                    <option value="7">7 - Extremely confident</option>
                </select>
            </div>

            <div class="form-group">
                <label for="genai_future_use">How likely are you to use generative AI tools after this
                    experiment?</label>
                <select id="genai_future_use" name="genai_future_use" required>
                    <option value="">Select your likelihood</option>
                    <option value="1">1 - Extremely unlikely</option>
                    <option value="2">2 - Very unlikely</option>
                    <option value="3">3 - Somewhat unlikely</option>
                    <option value="4">4 - Neither likely nor unlikely</option>
                    <option value="5">5 - Somewhat likely</option>
                    <option value="6">6 - Very likely</option>
                    <option value="7">7 - Extremely likely</option>
                </select>
            </div>

            <div class="form-group idea-ratings">
                <h3>Rate Your Ideas</h3>
                <div id="ideaRatingsContainer">
                    <!-- Ideas and ratings will be dynamically added here -->
                </div>
            </div>

        </form>
        <div id="errorSurveyContainer">
            <div id="errorSurvey"></div>
        </div>
        <div id="surveyButton">
            <button type="submit" id="submitButton">Submit</button>
        </div>
    </div>

    <div id="endPage">
        <div style="max-width: 700px; text-align: center; margin: auto">
            <h2 style="color: #3498db; margin-bottom: 20px;">Experiment Completed!</h2>
            <p style="font-size: 18px; color: #e74c3c; margin-top: 20px;">
                Please keep this unique index for your payment confirmation:
            </p>
            <p id="endPageUniqueIndex" style="font-weight: bold; font-size: 18px; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0, 0, 0, 0.5); justify-content:center; align-items:center; color:#e74c3c; font-size:16px;">
        <div
            style="background:#fff; padding:20px; border-radius:12px; border: 1px solid #3498db; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; max-width: 80%; min-width: 300px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
            <p style="margin-bottom: 20px;">Time is up! Moving to the next page. Your answers have been saved.</p>
            <button id="closeModal" style="margin-top:10px;">OK</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA_IQTZ9seX84jj94ldroWf5FMZ1GZWlec",
            authDomain: "creautd-8d7d3.firebaseapp.com",
            databaseURL: "https://creautd-8d7d3-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "creautd-8d7d3",
            storageBucket: "creautd-8d7d3.appspot.com",
            messagingSenderId: "96441731480",
            appId: "1:96441731480:web:9797d7aaae86aecaa683ed",
            measurementId: "G-FSDDCEX397"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let experimentData = {
            uniqueIndex: null,
            conditionID: null,
            receivedID: null,
            pageTimings: {},
            gptPage: {
                messages: [],
                conversationHistory: [],
                idea: null
            },
            agePage: {
                age: null
            },
            autPage: {
                ideas: []
            },
            taskPage: {
                messages: [],
                conversationHistory: [],
                ideas: []
            },
            surveyPage: {
                responses: {},
            }
        };

        document.addEventListener('DOMContentLoaded', async (event) => {
            let currentPage = 'welcomePage';

            const receivedID = await updateAndGetReceivedID();
            const conditionID = determineConditionID(receivedID);
            console.log('Condition ID:', conditionID);

            addUniqueIndexDisplay();
            const uniqueIndex = generateUniqueIndex(conditionID);
            experimentData.uniqueIndex = uniqueIndex;
            document.querySelectorAll('[id^="uniqueIndexDisplay-"]').forEach(display => {
                display.textContent = uniqueIndex;
            });

            function sendToFirebase(data) {
                const uniqueID = data.uniqueIndex;
                firebase.database().ref('experiments/' + uniqueID).set(data, (error) => {
                    if (error) {
                        console.error("Data could not be saved. " + error);
                    } else {
                        console.log("Data saved successfully.");
                    }
                });
            }

            document.addEventListener('fullscreenchange', function () {
                if (!document.fullscreenElement && currentPage !== 'welcomePage' && currentPage !== 'endPage') {
                    terminateExperiment();
                }
            });

            async function terminateExperiment() {
                alert("Since you have exited the full-screen mode, the experiment has been ended. The data will be downloaded and sent to Firebase.");
                collectTaskResponses();
                collectSurveyResponses();
                await downloadExperimentData();
                sendToFirebase(experimentData);
            }

            function preventCopyPaste(e) {
                e.preventDefault();
                return false;
            }

            const inputs = document.querySelectorAll('input, textarea, [contenteditable]');

            inputs.forEach(input => {
                input.addEventListener('copy', preventCopyPaste);
                input.addEventListener('paste', preventCopyPaste);
                input.addEventListener('cut', preventCopyPaste);
            });

            document.addEventListener('dragover', function (e) {
                e.preventDefault();
                return false;
            }, false);

            document.addEventListener('drop', function (e) {
                e.preventDefault();
                return false;
            }, false);

            let countdownTimeReadyButton = 10; // LATER
            const readyButton = document.getElementById('readyButton');
            readyButton.innerText = 'Ready in ' + countdownTimeReadyButton;
            readyButton.disabled = true;
            const countdownIntervalReadyButton = setInterval(() => {
                countdownTimeReadyButton--;
                readyButton.innerText = 'Ready in ' + countdownTimeReadyButton;
                if (countdownTimeReadyButton <= 0) {
                    clearInterval(countdownIntervalReadyButton);
                    readyButton.innerText = 'I am ready!';
                    readyButton.disabled = false;
                }
            }, 1000);

            readyButton.addEventListener('click', function () {
                document.documentElement.requestFullscreen().catch((err) => {
                    console.warn("Error trying to enter full-screen mode:", err.message);
                });
                transitionToPage('gptPage'); // LATER
            });

            let countdownTimeAutButton = 10; // LATER
            const autButton = document.getElementById('autButton');

            function startAutButtonCountdown() {
                autButton.innerText = 'Ready in ' + countdownTimeAutButton;
                autButton.disabled = true;
                const countdownIntervalAutButton = setInterval(() => {
                    countdownTimeAutButton--;
                    autButton.innerText = 'Ready in ' + countdownTimeAutButton;
                    if (countdownTimeAutButton <= 0) {
                        clearInterval(countdownIntervalAutButton);
                        autButton.innerText = 'I am ready!';
                        autButton.disabled = false;
                    }
                }, 1000);
            }

            autButton.addEventListener('click', function () {
                transitionToPage('autPage');
            });

            let countdownTimeTaskButton = 20; // LATER
            const taskButton = document.getElementById('taskButton');

            function startTaskButtonCountdown() {
                taskButton.innerText = 'Ready in ' + countdownTimeTaskButton;
                taskButton.disabled = true;
                const countdownIntervalTaskButton = setInterval(() => {
                    countdownTimeTaskButton--;
                    taskButton.innerText = 'Ready in ' + countdownTimeTaskButton;
                    if (countdownTimeTaskButton <= 0) {
                        clearInterval(countdownIntervalTaskButton);
                        taskButton.innerText = 'I am ready!';
                        taskButton.disabled = false;
                    }
                }, 1000);
            }

            taskButton.addEventListener('click', function () {
                transitionToPage('taskPage');
            });

            const go2AgePage = document.getElementById('go2AgePage');
            const reasonAreaGPT = document.getElementById('reasonAreaGPT');
            const errorGPT = document.getElementById('errorGPT');
            const wordCountGPT = document.getElementById('wordCountGPT');
            const chatDisplayGptPage = document.getElementById('chatDisplayGptPage');

            // LATER
            let textMessageSent = false;
            let imageMessageSent = false;

            function getWordCount(text) {
                text = text.trim();
                if (/[\u4e00-\u9fa5]/.test(text)) {
                    return text.replace(/[^\u4e00-\u9fa5]/g, '').length;
                } else {
                    return text.split(/\s+/).filter(word => word.length > 0).length;
                }
            }

            function updateWordCountGPT() {
                const text = reasonAreaGPT.value.trim();
                const count = getWordCount(text);
                wordCountGPT.textContent = `Word Count: ${count}`;
                validateGptPage();
                experimentData.gptPage.idea = text;
            }

            function validateGptPage() {
                const wordCount = getWordCount(reasonAreaGPT.value);
                const hasEnoughWords = wordCount >= 20;
                const hasSentBothMessages = textMessageSent && imageMessageSent;

                if (!hasEnoughWords && !hasSentBothMessages) {
                    errorGPT.textContent = "Please send at least one message for a textual response and one message for an image response to the chatbot; Please give a description for your idea with at least 20 words.";
                } else if (!hasEnoughWords) {
                    errorGPT.textContent = "Please give a description for your idea with at least 20 words.";
                } else if (!hasSentBothMessages) {
                    errorGPT.textContent = "Please send at least one message for a textual response and one message for an image response to the chatbot.";
                } else {
                    errorGPT.textContent = "";
                }

                errorGPT.style.display = errorGPT.textContent ? 'block' : 'none';
                go2AgePage.disabled = !hasEnoughWords || !hasSentBothMessages;
            }

            reasonAreaGPT.addEventListener('input', updateWordCountGPT);

            document.getElementById('sendGptPage').addEventListener('click', () => {
                textMessageSent = true;
                validateGptPage();
            });

            document.getElementById('imageGptPage').addEventListener('click', () => {
                imageMessageSent = true;
                validateGptPage();
            });

            go2AgePage.addEventListener('click', function () {
                if (!this.disabled) {
                    transitionToPage('agePage');
                }
            });

            document.getElementById('go2SurveyPage').addEventListener('click', function () {
                if (!this.disabled) {
                    clearInterval(timer);
                    collectTaskResponses();
                    transitionToPage('surveyPage');
                }
            });

            document.getElementById('submitButton').addEventListener('click', async function (event) {
                event.preventDefault();
                if (validateSurveyInputs()) {
                    collectTaskResponses();
                    collectSurveyResponses();
                    endTimer('surveyPage');
                    await downloadExperimentData();
                    sendToFirebase(experimentData);
                    if (document.fullscreenElement) {
                        document.exitFullscreen().then(() => {
                            console.log('Exited full-screen mode.');
                        }).catch((err) => {
                            console.error(`Error attempting to exit full-screen mode: ${err}`);
                        });
                    }
                    transitionToPage('endPage');
                }
            });

            const sendGptPage = document.getElementById('sendGptPage');
            const sendTask = document.getElementById('sendTask');

            sendGptPage.addEventListener('click', async () => {
                const chatbotInput = document.getElementById('chatbotInputGptPage');
                const chatDisplay = document.getElementById('chatDisplayGptPage');
                const userMessage = chatbotInput?.value.trim();
                if (userMessage) {
                    displayMessage(userMessage, 'user', chatDisplay, 'gptPage');
                    chatbotInput.value = '';
                    await callOpenAIAPIForGptPage(userMessage, chatDisplay);
                }
            });

            sendTask.addEventListener('click', async () => {
                const chatbotInput = document.getElementById('chatbotInputTask');
                const chatDisplay = document.getElementById('chatDisplayTask');
                const userMessage = chatbotInput?.value.trim();
                if (userMessage) {
                    displayMessage(userMessage, 'user', chatDisplay, 'taskPage');
                    chatbotInput.value = '';
                    await callOpenAIAPIForTaskPage(userMessage, chatDisplay);
                }
            });

            const imageButtons = [
                { buttonId: 'imageGptPage', inputId: 'chatbotInputGptPage', displayId: 'chatDisplayGptPage' },
                { buttonId: 'imageTask', inputId: 'chatbotInputTask', displayId: 'chatDisplayTask' }
            ];

            imageButtons.forEach((buttonConfig) => {
                const button = document.getElementById(buttonConfig.buttonId);
                button.addEventListener('click', async () => {
                    const chatbotInput = document.getElementById(buttonConfig.inputId);
                    const chatDisplay = document.getElementById(buttonConfig.displayId);
                    const userMessage = chatbotInput?.value.trim();
                    if (userMessage) {
                        displayMessage(userMessage, 'user', chatDisplay, currentPage);
                        chatbotInput.value = '';
                        await callDALLE3API(userMessage, chatDisplay, currentPage);
                    }
                });
            });

            function displayMessage(message, sender, chatDisplay, pageId) {
                if (!chatDisplay) return;

                const messageElement = document.createElement('div');
                messageElement.classList.add('message', sender);

                if (sender === 'bot' && message.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = message;
                    img.alt = 'Generated image';
                    messageElement.appendChild(img);
                } else if (message instanceof HTMLElement) {
                    // This allows us to append the loader directly
                    messageElement.appendChild(message);
                } else {
                    messageElement.textContent = message;
                }

                chatDisplay.appendChild(messageElement);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;

                const messageData = { type: sender, content: message, timestamp: new Date().toISOString() };

                experimentData[pageId].messages.push(messageData);
            }

            async function callOpenAIAPIForGptPage(userMessage, chatDisplay) {
                await callOpenAIAPIForPage(userMessage, chatDisplay, 'gptPage');
            }

            async function callOpenAIAPIForTaskPage(userMessage, chatDisplay) {
                await callOpenAIAPIForPage(userMessage, chatDisplay, 'taskPage');
            }

            async function callOpenAIAPIForPage(userMessage, chatDisplay, pageId) {
                try {
                    // Create and display loading animation
                    const loaderElement = document.createElement('div');
                    loaderElement.classList.add('loader');
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('message', 'bot');
                    messageElement.appendChild(loaderElement);
                    chatDisplay.appendChild(messageElement);
                    chatDisplay.scrollTop = chatDisplay.scrollHeight;

                    const apiKeySnapshot = await database.ref('apiKeys/openai').once('value');
                    const apiKey = apiKeySnapshot.val();

                    // Get the conversation history for the current page
                    const conversationHistory = experimentData[pageId].conversationHistory;

                    // Add the new user message to the conversation history
                    conversationHistory.push({ role: "user", content: userMessage });

                    // Prepare the messages array for the API call
                    const messages = [
                        { role: "system", content: "You are a creative assistant. Please reply all questions with 100 words. For every idea you provided, please give detailed reasons for that." },
                        ...conversationHistory
                    ];

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "gpt-4",
                            messages: messages,
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch from OpenAI API');
                    }

                    const data = await response.json();
                    const botResponse = data.choices[0].message.content.trim();

                    // Add the bot's response to the conversation history
                    conversationHistory.push({ role: "assistant", content: botResponse });

                    // Update the experimentData
                    experimentData[pageId].conversationHistory = conversationHistory;

                    // Remove loading animation
                    chatDisplay.removeChild(messageElement);

                    // Display the bot's response
                    displayMessage(botResponse, 'bot', chatDisplay, pageId);
                } catch (error) {
                    console.error("Error calling the OpenAI API:", error);

                    // Remove loading animation in case of error
                    const loaderElement = chatDisplay.querySelector('.loader');
                    if (loaderElement) {
                        chatDisplay.removeChild(loaderElement.parentElement);
                    }

                    displayMessage("Failed to get a response from the AI.", 'bot', chatDisplay, pageId);
                }
            }

            async function callDALLE3API(userMessage, chatDisplay, pageId) {
                try {
                    // Create and display loading animation
                    const loaderElement = document.createElement('div');
                    loaderElement.classList.add('loader');
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('message', 'bot');
                    messageElement.appendChild(loaderElement);
                    chatDisplay.appendChild(messageElement);
                    chatDisplay.scrollTop = chatDisplay.scrollHeight;

                    const apiKeySnapshot = await database.ref('apiKeys/openai').once('value');
                    const apiKey = apiKeySnapshot.val();

                    const response = await fetch('https://api.openai.com/v1/images/generations', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "dall-e-3",
                            prompt: userMessage,
                            n: 1,
                            size: "1024x1024",
                            response_format: "b64_json"
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch from DALL-E 3 API');
                    }

                    const data = await response.json();
                    const imageData = data.data[0].b64_json;
                    const imageUrl = `data:image/png;base64,${imageData}`;

                    // Remove loading animation
                    chatDisplay.removeChild(messageElement);

                    // Display the generated image
                    displayMessage(imageUrl, 'bot', chatDisplay, pageId);

                } catch (error) {
                    console.error("Error calling the DALL-E 3 API:", error);

                    // Remove loading animation in case of error
                    const loaderElement = chatDisplay.querySelector('.loader');
                    if (loaderElement) {
                        chatDisplay.removeChild(loaderElement.parentElement);
                    }

                    displayMessage("Failed to generate an image.", 'bot', chatDisplay, pageId);
                }
            }

            let countdownIntervals = {};

            function startCountdown(duration, displayElementId) {
                var timer = duration, minutes, seconds;
                var countdownInterval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    document.getElementById(displayElementId).textContent = `Time left: ${minutes}:${seconds}`;

                    if (--timer < 0) {
                        clearInterval(countdownInterval);
                        if (currentPage === 'autPage') {
                            showModal(() => transitionToPage('beforeTaskPage'));
                        } else {
                            transitionToNextPage();
                        }
                    }
                }, 1000);
                countdownIntervals[displayElementId] = countdownInterval;
            }

            function setContentBasedOnCondition() {
                const [aiOrHm, wordPair, designGoal] = experimentData.conditionID.split('-');

                const taskChatbot = document.getElementById('taskLeftside');
                const taskRightside = document.getElementById('taskRightside');
                const beforeTaskInstructions = document.querySelector('#beforeTaskPage ul');

                const existingLastLi = beforeTaskInstructions.querySelector('li:last-child');
                if (existingLastLi && (existingLastLi.textContent.includes('No Generative AI Tools') || existingLastLi.textContent.includes('Use AI Assistant'))) {
                    existingLastLi.remove();
                }

                const newLi = document.createElement('li');
                newLi.style.marginBottom = '15px';
                newLi.style.textAlign = 'left';

                if (aiOrHm === 'HM') {
                    newLi.innerHTML = `<span style="color: #e74c3c; font-weight: bold;">! No Generative AI Tools:</span> You MUST NOT use
any generative AI tools, such as ChatGPT, to complete this task. Your work will be submitted to
AI detection. If AI usage is detected, you will NOT receive payment.`;
                    taskChatbot.style.display = 'none';
                } else {
                    newLi.innerHTML = `<span style="color: #e74c3c; font-weight: bold;">! Use AI Assistant:</span> You MUST use the AI Assistant to help you finish the ideation task. Please COMBINE your creativity with AI creativity. If you do not use the AI Assistant, you will NOT receive payment.`;
                    taskChatbot.style.display = 'flex';
                }
                beforeTaskInstructions.appendChild(newLi);

                const speedComparisonQuestion = document.querySelector('label[for="gpt_speed_comparison"]');
                const noveltyComparisonQuestion = document.querySelector('label[for="gpt_novelty_comparison"]');
                if (aiOrHm === 'HM') {
                    speedComparisonQuestion.textContent = "How much faster did you complete the task compared to how long it would have taken with generative AI tools?";
                    noveltyComparisonQuestion.textContent = "How much better in idea novelty did you complete the ideation task compared to how this task would have been with generative AI tools?";
                } else {
                    speedComparisonQuestion.textContent = "How much faster did you complete the task compared to how long it would have taken without generative AI tools?";
                    noveltyComparisonQuestion.textContent = "How much better in idea novelty did you complete the ideation task compared to how this task would have been without generative AI tools?";
                }

                let word1, word2;
                switch (wordPair) {
                    case 'NL':
                        word1 = 'Car';
                        word2 = 'Bicycle';
                        break;
                    case 'NH':
                        word1 = 'Mobility';
                        word2 = 'Portability';
                        break;
                    case 'RL':
                        word1 = 'Car';
                        word2 = 'Laptop';
                        break;
                    case 'RH':
                        word1 = 'Mobility';
                        word2 = 'Deduction';
                        break;
                }

                let goal = designGoal === 'UT' ? 'help children increase their cognitive ability' : 'help children to have fun';

                const taskInstructions = document.getElementById('taskInstructions');
                taskInstructions.innerHTML = `
    <div style="line-height: 1.6; font-size: 16px;">
        <span style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">TASK:</span>
            Please design <span style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">a toy</span>, anything a child (age 5–11) can use to play with, by combining these two concepts:
            <span style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">${word1}</span> and 
            <span style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">${word2}</span>.
            The design goal is to
            <span style="color: #e74c3c; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">${goal}</span>.
        <ul style="padding-left: 20px; margin-top: 20px;">
            <li style="margin-bottom: 10px;">Your ideation should disregard production cost.</li>
            <li style="margin-bottom: 10px;">Submit at least three ideas and give a description for each idea with at least 20 words.</li>
            <li style="margin-bottom: 10px;">${aiOrHm === 'HM'
                        ? '<span style="color: #e74c3c; font-weight: bold;">You MUST NOT use any generative AI tools, such as ChatGPT, to complete this task. Your work will be submitted to AI detection. If AI usage is detected, you will NOT receive payment.</span>'
                        : '<span style="color: #e74c3c; font-weight: bold;">You MUST use the AI Assistant to help you finish the ideation task. Please COMBINE your creativity with AI creativity. If you do not use the AI Assistant, you will NOT receive payment.</span>'}
            </li>
        </ul>
    </div>
`;
            }
            function transitionToPage(pageName) {
                if (countdownIntervals[currentPage]) {
                    clearInterval(countdownIntervals[currentPage]);
                    delete countdownIntervals[currentPage];
                }

                endTimer(currentPage);
                document.getElementById(currentPage).style.display = 'none';
                document.getElementById(pageName).style.display = 'flex';

                document.querySelectorAll('[id^="uniqueIndexDisplay-"]').forEach(display => {
                    display.style.display = 'none';
                });
                document.getElementById(`uniqueIndexDisplay-${pageName}`).style.display = 'block';

                currentPage = pageName;
                startTimer(pageName);

                experimentData.gptPage.conversationHistory = [];
                experimentData.taskPage.conversationHistory = [];

                switch (pageName) {
                    case 'gptPage':
                        sendPredefinedGptMessage();
                        break;
                    case 'agePage':
                        startAutButtonCountdown();
                        break;
                    case 'autPage':
                        startCountdown(120, 'autCountdown'); // LATER
                        break;
                    case 'beforeTaskPage':
                        startTaskButtonCountdown();
                        setContentBasedOnCondition();
                        break;
                    case 'taskPage':
                        setContentBasedOnCondition();
                        startTaskTimer();
                        displayGreetingMessage();
                        break;
                    case 'surveyPage':
                        setContentBasedOnCondition();
                        addIdeaRatings();
                        break;
                    case 'endPage':
                        document.getElementById('endPageUniqueIndex').textContent = experimentData.uniqueIndex;
                        break;
                }
            }

            function transitionToNextPage() {
                const nextPageFunction = function () {
                    if (currentPage === 'gptPage') {
                        transitionToPage('taskPage');
                    } else if (currentPage === 'taskPage') {
                        transitionToPage('surveyPage');
                    } else {
                        transitionToPage('endPage');
                    }
                };

                showModal(nextPageFunction);
            }

            function showModal(nextPageFunction) {
                var modal = document.getElementById('modal');
                var closeModal = document.getElementById('closeModal');
                modal.style.display = 'flex';

                closeModal.onclick = function () {
                    modal.style.display = 'none';
                    nextPageFunction();
                };
            }

            function startTimer(pageName) {
                const startTime = new Date();
                experimentData.pageTimings[pageName] = { start: startTime.getTime(), startReadable: startTime.toLocaleString() };
            }

            function endTimer(pageName) {
                const endTime = new Date();
                if (experimentData.pageTimings[pageName] && experimentData.pageTimings[pageName].start) {
                    const startTime = experimentData.pageTimings[pageName].start;
                    const timeSpent = Math.floor((endTime.getTime() - startTime) / 1000);
                    experimentData.pageTimings[pageName].end = endTime.getTime();
                    experimentData.pageTimings[pageName].endReadable = endTime.toLocaleString();
                    experimentData.pageTimings[pageName].timeSpentSeconds = timeSpent;
                }
            }

            function validateSurveyInputs() {
                let isValid = true;
                let errorMessages = [];
                const surveyForm = document.getElementById('surveyForm');
                const inputs = surveyForm.querySelectorAll('input, select');
                let rangeInputChanged = false;

                inputs.forEach(input => {
                    if (input.required && !input.value.trim()) {
                        isValid = false;
                        const label = input.closest('.form-group').querySelector('label').textContent.replace(':', '');
                        errorMessages.push(`Please finish this question: ${label}`);
                    }
                });

                const rangeInputs = surveyForm.querySelectorAll('input[type="range"]');
                rangeInputs.forEach(input => {
                    if (input.value !== '4') {
                        rangeInputChanged = true;
                    }
                });

                if (!rangeInputChanged) {
                    isValid = false;
                    errorMessages.push('Please adjust at least one rating bar.');
                }

                const errorSurvey = document.getElementById('errorSurvey');
                const errorSurveyContainer = document.getElementById('errorSurveyContainer');
                if (!isValid) {
                    errorSurvey.innerHTML = errorMessages.join('<br>');
                    errorSurveyContainer.style.display = 'block';
                } else {
                    errorSurvey.innerHTML = '';
                    errorSurveyContainer.style.display = 'none';
                }

                return isValid;
            }

            function collectSurveyResponses() {
                const surveyForm = document.getElementById('surveyForm');
                const formData = new FormData(surveyForm);
                for (let [key, value] of formData.entries()) {
                    experimentData.surveyPage.responses[key] = value;
                }
            }

            function addAnswerField() {
                const answersContainer = document.getElementById('autAnswers');
                const newAnswer = document.createElement('textarea');
                newAnswer.className = 'autAnswer';
                newAnswer.placeholder = 'Enter a novel use for a paper clip';
                newAnswer.addEventListener('input', function () {
                    experimentData.autPage.ideas = Array.from(document.querySelectorAll('.autAnswer')).map(textarea => textarea.value);
                });
                answersContainer.appendChild(newAnswer);
            }

            document.getElementById('addAnswerButton').addEventListener('click', addAnswerField);

            const ageInput = document.getElementById('ageInput');
            ageInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/[^0-9]/g, '');
                let value = parseInt(this.value);
                if (value < 1) this.value = '1';
                if (value > 120) this.value = '120';
                experimentData.agePage.age = this.value;
            });

            ageInput.addEventListener('keydown', function (e) {
                if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||
                    (e.keyCode === 65 && e.ctrlKey === true) ||
                    (e.keyCode === 67 && e.ctrlKey === true) ||
                    (e.keyCode === 86 && e.ctrlKey === true) ||
                    (e.keyCode === 88 && e.ctrlKey === true) ||
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    return;
                }
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });

            const ideaInputs = document.getElementById('ideaInputs');
            const addIdeaButton = document.getElementById('addIdeaButton');
            const go2SurveyPage = document.getElementById('go2SurveyPage');
            const errorTask = document.getElementById('errorTask');
            const addIdeaError = document.getElementById('addIdeaError');

            let timer;
            let timerComplete = false;

            function validateFirstThreeIdeas() {
                const textareas = document.querySelectorAll('#ideaInputs .reasonarea');
                if (textareas.length < 3) return false;

                for (let i = 0; i < 3; i++) {
                    const wordCount = getWordCount(textareas[i].value);
                    if (wordCount < 20) return false;
                }
                return true;
            }

            function addIdeaField() {
                if (!validateFirstThreeIdeas()) {
                    addIdeaError.textContent = "Please finish the first three ideas before adding more ideas.";
                    return;
                }

                addIdeaError.textContent = "";

                const newIdeaContainer = document.createElement('div');
                newIdeaContainer.className = 'ideaContainer';
                newIdeaContainer.innerHTML = `<textarea class="reasonarea" placeholder="Enter an idea here..."></textarea>
<div class="wordCount">Word Count: 0</div>
`;
                ideaInputs.appendChild(newIdeaContainer);
                updateWordCount(newIdeaContainer.querySelector('.reasonarea'), newIdeaContainer.querySelector('.wordCount'));
                const ideasContainer = document.getElementById('ideasContainer');
                ideasContainer.scrollTop = ideasContainer.scrollHeight;

                updateTaskPageIdeas();
            }

            function updateTaskPageIdeas() {
                experimentData.taskPage.ideas = Array.from(document.querySelectorAll('#ideaInputs .reasonarea')).map(textarea => textarea.value);
            }

            function validateSubmission() {
                const textareas = document.querySelectorAll('#ideaInputs .reasonarea');
                let isValid = true;

                if (textareas.length < 3) {
                    isValid = false;
                } else {
                    for (let i = 0; i < 3; i++) {
                        const wordCount = getWordCount(textareas[i].value);
                        if (textareas[i].value.trim() === '' || wordCount < 20) {
                            isValid = false;
                            break;
                        }
                    }
                }

                const errorTask = document.getElementById('errorTask');
                errorTask.style.display = isValid ? 'none' : 'inline';
                go2SurveyPage.disabled = !(timerComplete && isValid);

                if (timerComplete) {
                    go2SurveyPage.textContent = isValid ? 'Next' : 'Complete All Tasks';
                }
            }

            function startTaskTimer() {
                let timeLeft = 300; // LATER
                go2SurveyPage.disabled = true;

                timer = setInterval(() => {
                    timeLeft--;
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    go2SurveyPage.textContent = `Submit (Clickable in ${minutes}:${seconds.toString().padStart(2, '0')})`;

                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        timerComplete = true;
                        go2SurveyPage.textContent = 'Next';
                        validateSubmission();
                    }
                }, 1000);
            }

            function updateWordCount(textarea, wordCountElement) {
                textarea.addEventListener('input', function () {
                    const text = textarea.value.trim();
                    let count;

                    if (/[\u4e00-\u9fa5]/.test(text)) {
                        count = text.replace(/[^\u4e00-\u9fa5]/g, '').length;
                    } else {
                        count = text.split(/\s+/).filter(word => word.length > 0).length;
                    }

                    wordCountElement.textContent = `Word Count: ${count}`;
                    if (currentPage === 'taskPage' && timerComplete) {
                        validateSubmission();
                    }

                    if (validateFirstThreeIdeas()) {
                        addIdeaError.textContent = "";
                    }

                    updateTaskPageIdeas();
                });
            }

            function collectTaskResponses() {
                const ideas = [];
                document.querySelectorAll('#ideaInputs .reasonarea').forEach((textarea, index) => {
                    ideas.push({
                        idea: index + 1,
                        description: textarea.value.trim(),
                        wordCount: getWordCount(textarea.value)
                    });
                });
                experimentData.taskPage.ideas = ideas;
            }

            addIdeaButton.addEventListener('click', addIdeaField);

            document.querySelectorAll('#ideaInputs .reasonarea').forEach(textarea => {
                updateWordCount(textarea, textarea.nextElementSibling);
            });

            function addIdeaRatings() {
                const ideaRatingsContainer = document.getElementById('ideaRatingsContainer');
                ideaRatingsContainer.innerHTML = '';

                const ideas = experimentData.taskPage.ideas;

                ideas.forEach((idea, index) => {
                    const ideaRatingDiv = document.createElement('div');
                    ideaRatingDiv.className = 'idea-rating-row';

                    const aspectsToRate = [
                        { name: 'originality', label: 'original' },
                        { name: 'innovativeness', label: 'innovative' },
                        { name: 'novelty', label: 'novel' },
                        { name: 'practicality', label: 'practical' },
                        { name: 'effectiveness', label: 'effective' },
                        { name: 'usefulness', label: 'useful' }
                    ];

                    let ideaHtml = `<div class="idea-column">
<h4>Idea ${index + 1}</h4>
<p>${idea.description}</p>
</div>
<div class="ratings-column">
`;
                    aspectsToRate.forEach(aspect => {
                        ideaHtml += `<div class="rating-row">
    <span class="range-label left">Not at all ${aspect.label}</span>
    <input type="range" id="idea${index + 1}-${aspect.name}" name="idea${index + 1}-${aspect.name}" 
           min="1" max="7" value="4" required>
    <span class="range-label right">Very ${aspect.label}</span>
    <span class="range-value">4</span>
</div>
`;
                    }); ideaHtml += `</div>`;
                    ideaRatingDiv.innerHTML = ideaHtml;
                    ideaRatingsContainer.appendChild(ideaRatingDiv);
                });

                document.querySelectorAll('.ratings-column input[type="range"]').forEach(input => {
                    input.addEventListener('input', function () {
                        this.nextElementSibling.nextElementSibling.textContent = this.value;
                    });
                });
            }

            async function updateAndGetReceivedID() {
                const ref = database.ref('receivedID');
                const snapshot = await ref.once('value');
                const currentID = snapshot.val() || 0;
                const newID = currentID + 1;
                await ref.set(newID);
                experimentData.receivedID = newID;
                return newID;
            }

            function determineConditionID(receivedID) {
                const conditions = [
                    'HM-NL-UT', 'HM-NH-UT', 'HM-RL-UT', 'HM-RH-UT',
                    'HM-NL-HD', 'HM-NH-HD', 'HM-RL-HD', 'HM-RH-HD',
                    'AI-NL-UT', 'AI-NH-UT', 'AI-RL-UT', 'AI-RH-UT',
                    'AI-NL-HD', 'AI-NH-HD', 'AI-RL-HD', 'AI-RH-HD'
                ];
                const conditionID = conditions[(receivedID - 1) % 16];
                experimentData.conditionID = conditionID;
                return conditionID;
            }

            function generateUniqueIndex(conditionID) {
                const conditionIDNoDash = conditionID.replace(/-/g, '');
                const now = new Date();
                const startDate = now.getFullYear().toString() +
                    (now.getMonth() + 1).toString().padStart(2, '0') +
                    now.getDate().toString().padStart(2, '0');
                const startTime = now.getHours().toString().padStart(2, '0') +
                    now.getMinutes().toString().padStart(2, '0');
                const uniqueID = Math.random().toString(36).substring(2, 8).toUpperCase();
                const uniqueIndex = `${receivedID}-V${conditionIDNoDash}${startDate}${startTime}${uniqueID}`;
                experimentData.uniqueIndex = uniqueIndex;
                return uniqueIndex;
            }

            function addUniqueIndexDisplay() {
                const pages = ['welcomePage', 'gptPage', 'agePage', 'autPage', 'beforeTaskPage', 'taskPage', 'surveyPage', 'endPage'];
                pages.forEach(pageId => {
                    const page = document.getElementById(pageId);
                    const uniqueIndexDisplay = document.createElement('div');
                    uniqueIndexDisplay.id = `uniqueIndexDisplay-${pageId}`;
                    uniqueIndexDisplay.style.position = 'fixed';
                    uniqueIndexDisplay.style.bottom = '10px';
                    uniqueIndexDisplay.style.right = '10px';
                    uniqueIndexDisplay.style.color = '#cccccc';
                    uniqueIndexDisplay.style.fontSize = '12px';
                    uniqueIndexDisplay.style.zIndex = '1000';
                    page.appendChild(uniqueIndexDisplay);
                });
            }

            function downloadExperimentData() {
                const jsonString = JSON.stringify(experimentData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${experimentData.uniqueIndex}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            validateGptPage();

            document.addEventListener('DOMContentLoaded', async (event) => {
                transitionToPage('welcomePage');
            });
        });
    </script>

</body>

</html>
