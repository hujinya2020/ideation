<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main_page</title>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #333;
        }

        #taskRightside,
        #taskLeftside,
        #gptLeftside,
        #gptRightside {
            width: 48%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            margin-bottom: 5vh;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        #chatbot {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        #taskRightside,
        #taskLeftside,
        #gptLeftside {
            text-align: center;
        }

        #errorTask {
            color: #d9534f;
            display: none;
            font-size: 12px;
            width: 100%;
            text-align: center;
            margin-top: 10px;
        }

        #aut-container {
            width: 70%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #fff;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            margin-bottom: 5vh;
            padding: 20px;
            box-sizing: border-box;
        }

        #chatbot>p {
            background-color: #ffffff;
            color: #333;
            margin: 0;
            padding: 15px;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            align-items: center;
            font-weight: bold;
            border-radius: 8px;
        }

        #taskInstructions,
        #gptInstructions,
        #gptTask,
        #ageAttention {
            padding: 20px;
            width: calc(100% - 60px);
            margin: 10px;
            background-color: #fff;
            border: 1px solid #e5e5e5;
            overflow-y: auto;
            border-radius: 8px;
            user-select: none;
            flex-grow: 1;
            text-align: left;
        }

        #autTask {
            padding: 20px;
            width: calc(100% - 60px);
            margin: 10px;
            background-color: #fff;
            border: 1px solid #e5e5e5;
            overflow-y: auto;
            border-radius: 8px;
            user-select: none;
            flex-grow: 1;
        }

        #gptInstructions {
            height: 20%;
        }

        #chatDisplayGptPage,
        #chatDisplayTask {
            flex: 1;
            overflow: auto;
            padding: 20px;
            max-width: 100%;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            display: flex;
            flex-direction: column;
            font-size: 12px;
            text-align: left;
        }

        #inputContainer {
            display: flex;
            align-items: center;
            background-color: #ffffff;
            border-top: 1px solid #e5e5e5;
            padding: 10px;
            border-radius: 0 0 8px 8px;
            margin-top: auto;
        }

        #chatbotInputGptPage,
        #chatbotInputTask {
            flex-grow: 1;
            margin: 0;
            border: none;
            background-color: #f7f7f8;
            color: #333;
            font-size: 12px;
            padding: 12px 16px;
            border-radius: 20px;
            resize: none;
            height: 56px;
            min-height: 56px;
            max-height: 200px;
            overflow-y: auto;
        }

        #chatbotInputGptPage::placeholder,
        #chatbotInputTask::placeholder {
            color: #8e8ea0;
        }

        #sendGptPage,
        #sendTask,
        #imageGptPage,
        #imageTask {
            width: 32px;
            height: 32px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 8px;
            transition: background-color 0.3s ease;
        }

        .send-icon,
        .image-icon {
            width: 16px;
            height: 16px;
            fill: #8e8ea0;
        }

        #sendGptPage:hover .send-icon,
        #sendTask:hover .send-icon,
        #imageGptPage:hover .image-icon,
        #imageTask:hover .image-icon {
            fill: #10a37f;
        }

        #namearea,
        #reasonarea,
        #nameAreaGPT,
        #reasonAreaGPT {
            width: calc(100% - 20px);
            margin: 10px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            resize: none;
            font-size: 13px;
        }

        #nameAreaGPT {
            height: 10%;
        }

        #reasonAreaGPT {
            height: 60%;
        }

        #namearea {
            height: 6%;
        }

        #reasonarea {
            height: 10%;
        }

        .message {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            max-width: 80%;
            line-height: 1.5;
        }

        .user {
            align-self: flex-end;
            background-color: #f7f7f8;
            border: 1px solid #e5e5e5;
        }

        .bot {
            align-self: flex-start;
            background-color: #f7f7f8;
            border: 1px solid #e5e5e5;
        }

        .bot img {
            max-width: 100%;
            border-radius: 8px;
        }

        .logo-icon {
            margin-right: 10px;
            height: 24px;
        }

        #readyButton,
        #submitButton,
        #go2SurveyPage,
        #go2AgePage,
        #autButton,
        #taskButton,
        #go2BeforeTaskPage {
            background-color: #10a37f;
            color: #ffffff;
            font-weight: bold;
            border-radius: 8px;
            padding: 12px 30px;
            margin-top: 20px;
            cursor: pointer;
            border: none;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        #go2SurveyPage,
        #go2AgePage,
        #go2BeforeTaskPage {
            width: calc(100% - 20px);
            margin: 10px;
        }

        #readyButton:hover,
        #submitButton:hover,
        #go2SurveyPage:hover,
        #autButton:hover,
        #taskButton:hover,
        #go2AgePage:hover,
        #go2BeforeTaskPage:hover {
            background-color: #0d8c6d;
        }

        #welcomePage,
        #gptPage,
        #agePage,
        #autPage,
        #beforeTaskPage,
        #taskPage,
        #surveyPage,
        #endPage {
            display: none;
            width: 95%;
            height: 95%;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 0vh;
            padding-top: 5vh;
            box-sizing: border-box;
            margin: auto;
            border-radius: 8px;
        }

        #welcomePage {
            display: flex;
            flex-direction: column;
        }

        #readyButton:disabled,
        #autButton:disabled,
        #taskButton:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }

        .word-count {
            padding: 5px;
            font-size: 14px;
            color: #666;
        }

        .wordCount {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
            align-self: flex-end;
            width: 90%;
        }

        #taskInstructions img.product-image {
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            border-radius: 8px;
            text-align: left;
        }

        #modal {
            background: rgba(0, 0, 0, 0.5);
        }

        #modal>div {
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
        }

        #closeModal {
            background-color: #10a37f;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
        }

        #closeModal:hover {
            background-color: #0d8c6d;
        }

        #ageInput {
            width: calc(100% - 20px);
            margin: 10px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            font-size: 12px;
        }

        .autAnswer {
            width: calc(100% - 20px);
            margin: 10px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            resize: none;
            font-size: 12px;
        }

        #addAnswerButtonContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }

        #addAnswerButtonContainer span {
            font-size: 14px;
        }

        #addAnswerButton {
            background-color: #10a37f;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #addAnswerButton:hover {
            background-color: #0d8c6d;
        }

        #ageAttention,
        #autTask {
            text-align: center;
            font-size: 18px;
            line-height: 1.6;
        }

        #ageInput {
            font-size: 16px;
            width: 100px;
            text-align: center;
            margin: 20px auto;
            display: block;
        }

        #autAnswers {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .autAnswer {
            width: 80%;
            margin: 10px auto;
        }

        #ideasContainer {
            max-height: 400px;
            padding: 20px;
            width: calc(100% - 60px);
            margin: 10px;
            background-color: #fff;
            border: 1px solid #e5e5e5;
            overflow-y: auto;
            border-radius: 8px;
            user-select: none;
            flex-grow: 1;
            align-items: center;
        }

        .ideaContainer {
            margin-bottom: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .reasonarea {
            width: 90%;
            height: 80px;
            min-height: 80px;
            max-height: 80px;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            padding: 10px;
            font-size: 12px;
            resize: none;
            overflow-y: auto;
        }

        .wordCount {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
            text-align: right;
        }

        #addIdeaButtonContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
            gap: 10px;
        }

        #addIdeaButtonContainer span {
            font-size: 14px;
        }

        #addIdeaButton {
            background-color: #10a37f;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #addIdeaButton:hover {
            background-color: #0d8c6d;
        }

        #go2SurveyPage:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #addIdeaError {
            color: #d9534f;
            height: 10px;
            margin-top: 0px;
            font-size: 11px;
        }

        #errorTaskContainer {
            height: 10px;
            margin-top: 0px;
            overflow: hidden;
        }

        #errorTask {
            color: #d9534f;
            font-size: 11px;
            line-height: 20px;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .radio-option {
            flex-basis: 14%;
            margin-bottom: 5px;
            text-align: center;
        }

        @media (max-width: 480px) {
            .radio-option {
                flex-basis: 25%;
            }
        }

        @media (max-width: 480px) {
            .radio-option {
                flex-basis: 33%;
            }
        }

        #surveyPage {
            align-items: center;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            max-height: 500px;
            background-color: white;
            flex-direction: column;
        }

        #surveyForm {
            margin-top: auto;
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            width: 80%;
            height: 80%;
            overflow-y: auto;
            text-align: center;
            flex-direction: column;
            padding: 20px;
            background-color: #f9f9f9;
            font-size: 14px;
        }

        #surveyTitle {
            text-align: center;
            color: #333;
            height: auto;
        }

        #surveyButton {
            margin-top: 20px;
            height: 20%;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #020202;
            text-align: center;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            max-width: 300px;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            text-align: center;
        }

        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23555' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 12px;
            padding-right: 2rem;
            text-align-last: center;
            font-size: 14px;
        }

        #errorSurvey {
            display: none;
            color: #d9534f;
            font-size: 12px;
            margin-bottom: 1rem;
            text-align: center;
        }

        #submitButton {
            display: block;
            width: 100%;
            max-width: 300px;
            padding: 0.75rem;
            background-color: #10a37f;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 0 auto;
        }

        #submitButton:hover {
            background-color: #0d8c6d;
        }

        .birthday-inputs {
            display: flex;
            gap: 10px;
            font-size: 14px;
        }

        .birthday-inputs input {
            width: 80px;
            font-size: 14px;
        }

        .recall-inputs {
            display: flex;
            gap: 10px;
            font-size: 14px;
        }

        .recall-inputs input {
            width: 200px;
            font-size: 14px;
        }

        .idea-ratings {
            margin-top: 20px;
        }

        .idea-rating-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border: 1px solid #e5e5e5;
            padding: 10px;
            border-radius: 8px;
        }

        .idea-column,
        .ratings-column {
            padding: 10px;
        }

        .idea-column {
            flex: 1 1 300px;
            min-width: 300px;
        }

        .ratings-column {
            flex: 2 1 400px;
        }

        .idea-column h4 {
            margin-top: 0;
        }

        .rating-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            position: relative;
        }

        .range-label {
            flex: 0 0 100px;
            font-size: 12px;
            white-space: nowrap;
        }

        .range-label.left {
            text-align: right;
            padding-right: 10px;
        }

        .range-label.right {
            text-align: left;
            padding-left: 10px;
        }

        .rating-row input[type="range"] {
            flex: 1;
            margin: 0 10px;
        }

        .range-value {
            flex: 0 0 20px;
            text-align: center;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .idea-rating-row {
                flex-direction: column;
            }

            .idea-column,
            .ratings-column {
                width: 100%;
            }

            .rating-row {
                flex-wrap: wrap;
            }

            .range-label {
                flex: 1 0 100%;
                text-align: center;
                margin-bottom: 5px;
            }

            .rating-row input[type="range"] {
                flex: 1 0 100%;
                margin: 10px 0;
            }

            .range-value {
                flex: 1 0 100%;
                text-align: center;
                margin-top: 5px;
            }
        }

        #errorContainer {
            height: 40px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #errorGPT {
            color: #d9534f;
            font-size: 12px;
            text-align: center;
            max-width: 80%;
        }

        #go2AgePage {
            background-color: #10a37f;
            color: #ffffff;
            font-weight: bold;
            border-radius: 8px;
            padding: 12px 30px;
            margin-top: 10px;
            cursor: pointer;
            border: none;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        #go2AgePage:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #go2AgePage:hover:not(:disabled) {
            background-color: #0d8c6d;
        }
    </style>
</head>

<body>
    <div id="welcomePage">
        <div style="max-width: 600px; text-align: center;">
            <h1 style="font-size: 24px; margin-bottom: 20px;"><strong>Thank you for participating!</strong></h1>
            <div style="padding: 20px; border: 2px solid #e5e5e5; border-radius: 8px; background-color: #f9f9f9;">
                <ul style="list-style-type: none; padding: 0;">
                    <li style="margin-bottom: 15px; text-align: left;">✓ Ensure your computer, keyboard, and mouse are
                        in good working condition.</li>
                    <li style="margin-bottom: 15px; text-align: left;">✗ The following session will be conducted in
                        full-screen mode. Please <span style="color: #d9534f; font-weight: bold;"> avoid
                            exiting full-screen mode</span>,as doing so will end the session prematurely.</li>
                    <li style="margin-bottom: 15px; text-align: left;">✓ You are going to finish <span
                            style="color: #d9534f; font-weight: bold;"> three tasks + one
                            survey</span>, the expected duration will be 8-10
                        minutes.</li>
                </ul>
            </div>
            <button id="readyButton">Getting Ready...</button>
            <div id="uniqueIndexDisplay"
                style="position: fixed; bottom: 10px; right: 10px; color: #cccccc; font-size: 12px; display :block">
            </div>
        </div>
    </div>

    <div id="gptPage">
        <div id=gptLeftside>
            <div id="chatbot">
                <p><strong>Chatbot</strong></p>
                <div id="chatDisplayGptPage"></div>
                <div id="inputContainer">
                    <textarea id="chatbotInputGptPage" placeholder="Send a message..."></textarea>
                    <button id="sendGptPage">
                        <svg class="send-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                        </svg>
                    </button>
                    <button id="imageGptPage">
                        <svg class="image-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="gptRightside">
            <div id="gptInstructions">
                <ul style="padding: 0; padding-left: 20px; text-align: left;">
                    <li style="margin-bottom: 10px;">Generative AI is a technology that can generate text, images, or
                        videos based on textual prompts. The chatbot shown in the left panel is a generative AI product.
                    </li>
                    <li style="margin-bottom: 10px;"> You can pose questions to facilitate the process of ideation. To
                        get the most out of chatbot, providing clear, detailed, and contextually rich prompts is key.
                        <ul style="list-style-type: circle; margin-top: 10px;">
                            <li style="margin-bottom: 10px;">Please click <svg class="send-icon" viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; vertical-align: middle;">
                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                                </svg> if you want the chatbot to generate textual responses.</li>
                            <li style="margin-bottom: 10px;">Please click <svg class="image-icon" viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                    style="width: 16px; height: 16px; vertical-align: middle;">
                                    <path
                                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z">
                                    </path>
                                </svg> if you want the chatbot to generate images. </li>

                            <li style="margin-bottom: 10px;">Please wait for 8-10 seconds for
                                responses.</li>
                        </ul>
                    </li>
                    <li style="margin-bottom: 10px;"><span
                            style="margin-bottom: 10px;  background-color: #F7CE5D; color: #000000; font-weight: bold; padding: 2px 5px; border-radius: 3px; font-size: 1.2em;">SUBTASK
                            1:</span> To help you familiarize this
                        tool, you are required to send at least <span
                            style="margin-bottom: 10px; color: #d9534f;font-weight: bold;"> one message for a textual
                            response and one message for a image response </span> to the chatbot.
                        Please let it help you finish the task below.
                    </li>
                </ul>
            </div>
            <div id="gptTask">
                <ul style="padding: 0; padding-left: 20px; text-align: left;">
                    <li style="margin-bottom: 10px;"> <span
                            style="margin-bottom: 10px; background-color: #F7CE5D; color: #000000; font-weight: bold; padding: 2px 5px; border-radius: 3px; font-size: 1.2em;">SUBTASK
                            2:</span> Please design <span style="color: #d9534f; font-weight: bold;"> a
                            daily necessity by combining these two concepts: spoon and fork</span>.
                    </li>
                    <li style="margin-bottom: 10px;"> Please give a description for
                        your idea with at least 20 words.</li>
                </ul>
                <textarea id="reasonAreaGPT" placeholder="Enter your idea here..."></textarea>
                <div id="wordCountGPT" class="word-count">Word Count: 0</div>
            </div>
            <div id="errorContainer" style="height: 40px; margin-top: 10px;">
                <span id="errorGPT" style="color: #d9534f; display: none; font-size: 12px;"></span>
            </div>
            <button id="go2AgePage" disabled>Next</button>
        </div>
    </div>

    <div id="agePage">
        <div style="max-width: 600px; text-align: center;">
            <h1 style="font-size: 24px; margin-bottom: 20px;"><strong>Upcoming: Alternative Uses Test</strong></h1>
            <div style="padding: 20px; border: 2px solid #e5e5e5; border-radius: 8px; background-color: #f9f9f9;">
                <p style="margin-bottom: 20px;">Before we proceed, please provide your age.</p>
                <input type="number" id="ageInput" placeholder="Age" min="1" max="120"
                    style="font-size: 16px; width: 100px; text-align: center; margin: 0 auto 20px; display: block; padding: 10px; border: 1px solid #e5e5e5; border-radius: 4px;">
                <p style="margin-bottom: 15px; text-align: left;">✓ In the next page, you will complete a test by
                    <span style="color: #d9534f; font-weight: bold;"> listing novel uses for a paper clip</span> in 30
                    seconds.
                </p>
                <p style="margin-bottom: 15px; text-align: left;">✓ The countdown will <span
                        style="color: #d9534f; font-weight: bold;">start immediately</span> after you press
                    the "I'm Ready" button. Please ensure you're prepared before clicking the button.</p>
            </div>
            <button id="autButton" disabled style="margin-top: 20px;">Getting Ready...</button>
        </div>
    </div>

    <div id="autPage">
        <div id="aut-container">
            <div id="autCountdown" style="text-align:center; font-size:20px; margin-top:10px; font-weight: bold;">Time
                left: 30:00</div>
            <div id="autTask">
                <p><span
                        style="margin-bottom: 10px; background-color: #F7CE5D; color: #000000; font-weight: bold; padding: 2px 5px; border-radius: 3px; font-size: 1.2em;">TASK:</span>Please
                    list novel uses for <span style="color: #d9534f; font-weight: bold;"> a paper clip</span> as many as
                    possible in 30
                    seconds.</p>
                <div id="autAnswers">
                    <textarea class="autAnswer" placeholder="Enter a novel use for a paper clip"></textarea>
                </div>
            </div>
            <div id="addAnswerButtonContainer">
                <span>Click "+" button and scroll down to add more uses</span>
                <button id="addAnswerButton">+</button>
            </div>
        </div>
    </div>

    <div id="beforeTaskPage">
        <div style="max-width: 700px; text-align: center;">
            <h1 style="font-size: 24px; margin-bottom: 20px;"><strong>Upcoming: Creative Ideation Task</strong></h1>
            <div style="padding: 20px; border: 2px solid #e5e5e5; border-radius: 8px; background-color: #f9f9f9;">
                <ul style="list-style-type: none; padding: 0;">
                    <li style="margin-bottom: 15px; text-align: left;"><span
                            style="color: #d9534f; font-weight: bold;">✓ Unlimited Time:</span> You have unlimited time
                        to complete this task. The minimum time required for this task is five minutes.</li>
                    <li style="margin-bottom: 15px; text-align: left;"><span
                            style="color: #d9534f; font-weight: bold;">✓ At Least Three Ideas:</span> Please generate a
                        minimum of three ideas. Feel free to be as creative as possible and submit your answers once you
                        are satisfied. </li>
                    <li style="margin-bottom: 15px; text-align: left;"><span
                            style="color: #d9534f; font-weight: bold;">✓ Payment:</span> Complete the tasks to receive a
                        base compensation of $5. If any of your ideas rank in the top 20% for novelty, as rated by
                        external evaluators, you will earn an additional $3 bonus.</li>
                    <!-- The "No Generative AI Tools" list item will be dynamically added or removed here -->
                </ul>
            </div>
            <button id="taskButton" disabled style="margin-top: 20px;">Getting Ready...</button>
        </div>
    </div>

    <div id="taskPage">
        <div id="taskLeftside">
            <div id="chatbot">
                <p><strong>Chatbot</strong></p>
                <div id="chatDisplayTask"></div>
                <div id="inputContainer">
                    <textarea id="chatbotInputTask" placeholder="Send a message..."></textarea>
                    <button id="sendTask">
                        <svg class="send-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                        </svg>
                    </button>
                    <button id="imageTask">
                        <svg class="image-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="taskRightside">
            <div id="taskInstructions">
                <!--Dynamic generation -->
            </div>
            <div id="ideasContainer">
                <div id="ideaInputs">
                    <div class="ideaContainer">
                        <textarea class="reasonarea" placeholder="Enter your idea here..."></textarea>
                        <div class="wordCount">Word Count: 0</div>
                    </div>
                    <div class="ideaContainer">
                        <textarea class="reasonarea" placeholder="Enter your description here..."></textarea>
                        <div class="wordCount">Word Count: 0</div>
                    </div>
                    <div class="ideaContainer">
                        <textarea class="reasonarea" placeholder="Enter your description here..."></textarea>
                        <div class="wordCount">Word Count: 0</div>
                    </div>
                </div>
            </div>
            <div id="addIdeaButtonContainer">
                <span>Click "+" button and scroll down to add more ideas</span>
                <button id="addIdeaButton">+</button>
            </div>
            <div id="addIdeaError"></div>
            <div id="errorTaskContainer" style="height: 20px; margin-top: 10px;">
                <span id="errorTask" style="color: #d9534f; display: none; font-size: 11px;">Please submit at least
                    three ideas with at least 20 words for each idea.</span>
            </div>
            <button id="go2SurveyPage" disabled>Submit</button>
        </div>
    </div>

    <div id="surveyPage">
        <div id="surveyTitle">
            <h2>Survey</h2>
        </div>
        <form id="surveyForm">
            <div id="surveyErrors" style="color: #d9534f; margin-bottom: 10px;"></div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="text" id="email" name="email" placeholder="Email" required>
            </div>

            <div class="form-group">
                <label for="birthday">Birthday:</label>
                <div class="birthday-inputs">
                    <input type="number" id="birthdayYear" name="birthdayYear" placeholder="Year" required min="1900"
                        max="2024">
                    <input type="number" id="birthdayMonth" name="birthdayMonth" placeholder="Month" required min="1"
                        max="12">
                    <input type="number" id="birthdayDay" name="birthdayDay" placeholder="Day" required min="1"
                        max="31">
                </div>
            </div>

            <div class="form-group">
                <label for="gender">Gender:</label>
                <select id="gender" name="gender" required>
                    <option value="">Select your gender</option>
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                    <option value="other">Other</option>
                    <option value="prefer_not_to_say">Prefer not to say</option>
                </select>
            </div>

            <div class="form-group">
                <label for="education">Education:</label>
                <select id="education" name="education" required>
                    <option value="">Select your education level</option>
                    <option value="doctorate">Doctorate Degree</option>
                    <option value="professional">Professional Degree</option>
                    <option value="masters">Master's Degree</option>
                    <option value="bachelors">Bachelor's Degree</option>
                    <option value="high_school">High School or Equivalent</option>
                    <option value="less_than_high_school">Less than High School</option>
                </select>
            </div>

            <div class="form-group">
                <label for="english_proficiency">English Proficiency:</label>
                <select id="english_proficiency" name="english_proficiency" required>
                    <option value="">Select your English proficiency level</option>
                    <option value="native">Native or Bilingual</option>
                    <option value="full_professional">Full Professional</option>
                    <option value="professional_working">Professional Working</option>
                    <option value="limited_working">Limited Working</option>
                    <option value="elementary">Elementary Proficiency</option>
                    <option value="no_proficiency">No Proficiency</option>
                </select>
            </div>

            <div class="form-group">
                <label for="race">Race:</label>
                <select id="race" name="race" required>
                    <option value="">Select your race</option>
                    <option value="african_american">African American</option>
                    <option value="asian">Asian</option>
                    <option value="american_indian">American Indian/Alaska Native</option>
                    <option value="hispanic">Hispanic or Latino</option>
                    <option value="white">White or Caucasian</option>
                    <option value="native_hawaiian">Native Hawaiian/Pacific Islander</option>
                    <option value="other">Others</option>
                </select>
            </div>

            <div class="form-group">
                <label for="employment_status">Employment Status:</label>
                <select id="employment_status" name="employment_status" required>
                    <option value="">Select your employment status</option>
                    <option value="student">Student</option>
                    <option value="employee">Employee</option>
                    <option value="unemployed">Unemployed</option>
                    <option value="retired">Retired</option>
                </select>
            </div>

            <div class="form-group">
                <label for="work_experience">Work Experience:</label>
                <input type="number" id="work_experience" name="work_experience" placeholder="Years" required>
            </div>

            <div class="form-group">
                <label for="recall">What were the two concepts you just combined to create your toy design?</label>
                <div class="recall-inputs">
                    <input type="text" id="recall-word1" name="recall-word1" placeholder="Word 1" required>
                    <input type="text" id="recall-word2" name="recall-word2" placeholder="Word 2" required>
                </div>
            </div>

            <div class="form-group">
                <label for="task_familiarity">How frequently do you perform tasks similar to the one you just did in
                    your daily life?</label>
                <select id="task_familiarity" name="task_familiarity" required>
                    <option value="">Select frequency</option>
                    <option value="every_day">Every day</option>
                    <option value="few_times_week">A few times a week</option>
                    <option value="once_week">Once a week</option>
                    <option value="2_3_times_month">2-3 times a month</option>
                    <option value="once_month">Once a month</option>
                    <option value="less_than_once_month">Less than once a month</option>
                    <option value="never">Never</option>
                </select>
            </div>

            <div class="form-group">
                <label for="genai_familiarity">How frequently do you use generative AI tools (such as ChatGPT) in your
                    daily life?</label>
                <select id="genai_familiarity" name="genai_familiarity" required>
                    <option value="">Select frequency</option>
                    <option value="every_day">Every day</option>
                    <option value="few_times_week">A few times a week</option>
                    <option value="once_week">Once a week</option>
                    <option value="2_3_times_month">2-3 times a month</option>
                    <option value="once_month">Once a month</option>
                    <option value="less_than_once_month">Less than once a month</option>
                    <option value="never">Never</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_human_disease">How much would you trust a human doctor for diagnosing a
                    disease?</label>
                <select id="algorithm_trust_human_disease" name="algorithm_trust_human_disease" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_ai_disease">How much would you trust an algorithm for diagnosing a
                    disease?</label>
                <select id="algorithm_trust_ai_disease" name="algorithm_trust_ai_disease" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_human_music">How much would you trust a human composer for composing a
                    song?</label>
                <select id="algorithm_trust_human_music" name="algorithm_trust_human_music" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="algorithm_trust_ai_music">How much would you trust an algorithm for composing a
                    song?</label>
                <select id="algorithm_trust_ai_music" name="algorithm_trust_ai_music" required>
                    <option value="">Select trust level</option>
                    <option value="1">1 - Completely distrust</option>
                    <option value="2">2 - Mostly distrust</option>
                    <option value="3">3 - Somewhat distrust</option>
                    <option value="4">4 - Neutral</option>
                    <option value="5">5 - Somewhat trust</option>
                    <option value="6">6 - Mostly trust</option>
                    <option value="7">7 - Completely trust</option>
                </select>
            </div>

            <div class="form-group">
                <label for="gpt_speed_comparison">How much faster did you complete the task compared to how long it
                    would have taken without generative AI tools?</label>
                <select id="gpt_speed_comparison" name="gpt_speed_comparison" required>
                    <option value="">Select your answer</option>
                    <option value="1">1 (Much slower)</option>
                    <option value="2">2 (Slower)</option>
                    <option value="3">3 (Slightly slower)</option>
                    <option value="4">4 (About the same speed)</option>
                    <option value="5">5 (Faster)</option>
                    <option value="6">6 (Much faster)</option>
                    <option value="7">7 (Extremely faster)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="gpt_novelty_comparison">How much better in idea novelty did you complete the ideation task
                    compared to how this task would have been without generative AI tools?</label>
                <select id="gpt_novelty_comparison" name="gpt_novelty_comparison" required>
                    <option value="">Select your answer</option>
                    <option value="1">1 (Much less novel)</option>
                    <option value="2">2 (Less novel)</option>
                    <option value="3">3 (Slightly less novel)</option>
                    <option value="4">4 (About the same novelty)</option>
                    <option value="5">5 (More novel)</option>
                    <option value="6">6 (Much more novel)</option>
                    <option value="7">7 (Extremely more novel)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="creative_confidence">In the toy design task, how confident are you in your ability to solve
                    the problem creatively?</label>
                <select id="creative_confidence" name="creative_confidence" required>
                    <option value="">Select your confidence level</option>
                    <option value="1">1 (Not at all confident)</option>
                    <option value="2">2 (Slightly confident)</option>
                    <option value="3">3 (Somewhat confident)</option>
                    <option value="4">4 (Moderately confident)</option>
                    <option value="5">5 (Very confident)</option <option value="6">6 (Highly confident)</option>
                    <option value="7">7 (Extremely confident)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="genai_future_use">How likely are you to use generative AI tools after this
                    experiment?</label>
                <select id="genai_future_use" name="genai_future_use" required>
                    <option value="">Select your likelihood</option>
                    <option value="1">1 (Extremely unlikely)</option>
                    <option value="2">2 (Very unlikely)</option>
                    <option value="3">3 (Somewhat unlikely)</option>
                    <option value="4">4 (Neither likely nor unlikely)</option>
                    <option value="5">5 (Somewhat likely)</option>
                    <option value="6">6 (Very likely)</option>
                    <option value="7">7 (Extremely likely)</option>
                </select>
            </div>

            <div class="form-group idea-ratings">
                <h3>Rate Your Ideas</h3>
                <div id="ideaRatingsContainer">
                    <!-- Ideas and ratings will be dynamically added here -->
                </div>
            </div>

        </form>
        <div id="errorSurvey" style="color: #d9534f; margin-top: 10px; display: none;"></div>
        <div id="surveyButton">
            <button type="submit" id="submitButton">Submit</button>
        </div>
    </div>

    <div id="endPage">
        <div style="max-width: 700px; text-align: center; margin: auto; margin-top: 200px">
            <strong>This is the end of the experiment! <br>
                <br>
                Thanks! </strong>
        </div>
    </div>

    <div id="modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0, 0, 0, 0.5); justify-content:center; align-items:center; color:#d9534f; font-size:16px;">
        <div
            style="background:#fff; padding:20px; border-radius:8px; border: 1px solid #e5e5e5; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; max-width: 80%; min-width: 300px;">
            <p style="margin-bottom: 20px;">Time is up! Moving to the next page. Your answers have been saved.</p>
            <button id="closeModal" style="margin-top:10px;">OK</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA_IQTZ9seX84jj94ldroWf5FMZ1GZWlec",
            authDomain: "creautd-8d7d3.firebaseapp.com",
            databaseURL: "https://creautd-8d7d3-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "creautd-8d7d3",
            storageBucket: "creautd-8d7d3.appspot.com",
            messagingSenderId: "96441731480",
            appId: "1:96441731480:web:9797d7aaae86aecaa683ed",
            measurementId: "G-FSDDCEX397"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let experimentData = {
            uniqueIndex: null,
            conditionID: null,
            receivedID: null,
            pageTimings: {},
            gptPage: {
                messages: []
            },
            agePage: {
                age: null
            },
            autPage: {
                ideas: []
            },
            taskPage: {
                messages: [],
                ideas: []
            },
            surveyPage: {
                responses: {},
            }
        };

        document.addEventListener('DOMContentLoaded', async (event) => {
            let currentPage = 'welcomePage';

            const receivedID = await updateAndGetReceivedID();
            const conditionID = determineConditionID(receivedID);
            console.log('Condition ID:', conditionID);

            addUniqueIndexDisplay();
            const uniqueIndex = generateUniqueIndex(conditionID);
            experimentData.uniqueIndex = uniqueIndex;
            document.querySelectorAll('[id^="uniqueIndexDisplay-"]').forEach(display => {
                display.textContent = uniqueIndex;
            });

            function sendToFirebase(data) {
                const uniqueID = data.uniqueIndex;
                firebase.database().ref('experiments/' + uniqueID).set(data, (error) => {
                    if (error) {
                        console.error("Data could not be saved. " + error);
                    } else {
                        console.log("Data saved successfully.");
                    }
                });
            }

            document.addEventListener('fullscreenchange', function () {
                if (!document.fullscreenElement && currentPage !== 'welcomePage' && currentPage !== 'endPage') {
                    terminateExperiment();
                }
            });

            async function terminateExperiment() {
                alert("Since you have exited the full-screen mode, the experiment has been ended. The data will be downloaded and sent to Firebase.");
                collectTaskResponses();
                collectSurveyResponses();
                await downloadExperimentData();
                sendToFirebase(experimentData);
            }

            function preventCopyPaste(e) {
                e.preventDefault();
                return false;
            }

            const inputs = document.querySelectorAll('input, textarea, [contenteditable]');

            inputs.forEach(input => {
                input.addEventListener('copy', preventCopyPaste);
                input.addEventListener('paste', preventCopyPaste);
                input.addEventListener('cut', preventCopyPaste);
            });

            document.addEventListener('dragover', function (e) {
                e.preventDefault();
                return false;
            }, false);

            document.addEventListener('drop', function (e) {
                e.preventDefault();
                return false;
            }, false);

            let countdownTimeReadyButton = 0.1;
            const readyButton = document.getElementById('readyButton');
            readyButton.innerText = 'Ready in ' + countdownTimeReadyButton;
            readyButton.disabled = true;
            const countdownIntervalReadyButton = setInterval(() => {
                countdownTimeReadyButton--;
                readyButton.innerText = 'Ready in ' + countdownTimeReadyButton;
                if (countdownTimeReadyButton <= 0) {
                    clearInterval(countdownIntervalReadyButton);
                    readyButton.innerText = 'I am ready!';
                    readyButton.disabled = false;
                }
            }, 1000);

            readyButton.addEventListener('click', function () {
                document.documentElement.requestFullscreen().catch((err) => {
                    console.warn("Error trying to enter full-screen mode:", err.message);
                });
                transitionToPage('gptPage');
            });

            let countdownTimeAutButton = 0.1;
            const autButton = document.getElementById('autButton');

            function startAutButtonCountdown() {
                autButton.innerText = 'Ready in ' + countdownTimeAutButton;
                autButton.disabled = true;
                const countdownIntervalAutButton = setInterval(() => {
                    countdownTimeAutButton--;
                    autButton.innerText = 'Ready in ' + countdownTimeAutButton;
                    if (countdownTimeAutButton <= 0) {
                        clearInterval(countdownIntervalAutButton);
                        autButton.innerText = 'I am ready!';
                        autButton.disabled = false;
                    }
                }, 1000);
            }

            autButton.addEventListener('click', function () {
                transitionToPage('autPage');
            });

            let countdownTimeTaskButton = 0.1;
            const taskButton = document.getElementById('taskButton');

            function startTaskButtonCountdown() {
                taskButton.innerText = 'Ready in ' + countdownTimeTaskButton;
                taskButton.disabled = true;
                const countdownIntervalTaskButton = setInterval(() => {
                    countdownTimeTaskButton--;
                    taskButton.innerText = 'Ready in ' + countdownTimeTaskButton;
                    if (countdownTimeTaskButton <= 0) {
                        clearInterval(countdownIntervalTaskButton);
                        taskButton.innerText = 'I am ready!';
                        taskButton.disabled = false;
                    }
                }, 1000);
            }

            taskButton.addEventListener('click', function () {
                transitionToPage('taskPage');
            });

            const go2AgePage = document.getElementById('go2AgePage');
            const reasonAreaGPT = document.getElementById('reasonAreaGPT');
            const errorGPT = document.getElementById('errorGPT');
            const wordCountGPT = document.getElementById('wordCountGPT');
            const chatDisplayGptPage = document.getElementById('chatDisplayGptPage');

            let textMessageSent = false;
            let imageMessageSent = false;

            function getWordCount(text) {
                text = text.trim();
                if (/[\u4e00-\u9fa5]/.test(text)) {
                    return text.replace(/[^\u4e00-\u9fa5]/g, '').length;
                } else {
                    return text.split(/\s+/).filter(word => word.length > 0).length;
                }
            }

            function updateWordCountGPT() {
                const text = reasonAreaGPT.value.trim();
                const count = getWordCount(text);
                wordCountGPT.textContent = `Word Count: ${count}`;
                validateGptPage();
                experimentData.gptPage.idea = text;
            }

            function validateGptPage() {
                const wordCount = getWordCount(reasonAreaGPT.value);
                const hasEnoughWords = wordCount >= 20;
                const hasSentBothMessages = textMessageSent && imageMessageSent;

                if (!hasEnoughWords && !hasSentBothMessages) {
                    errorGPT.textContent = "Please send at least one message for a textual response and one message for an image response to the chatbot; Please give a description for your idea with at least 20 words.";
                } else if (!hasEnoughWords) {
                    errorGPT.textContent = "Please give a description for your idea with at least 20 words.";
                } else if (!hasSentBothMessages) {
                    errorGPT.textContent = "Please send at least one message for a textual response and one message for an image response to the chatbot.";
                } else {
                    errorGPT.textContent = "";
                }

                errorGPT.style.display = errorGPT.textContent ? 'block' : 'none';
                go2AgePage.disabled = !hasEnoughWords || !hasSentBothMessages;
            }

            reasonAreaGPT.addEventListener('input', updateWordCountGPT);

            document.getElementById('sendGptPage').addEventListener('click', () => {
                textMessageSent = true;
                validateGptPage();
            });

            document.getElementById('imageGptPage').addEventListener('click', () => {
                imageMessageSent = true;
                validateGptPage();
            });

            go2AgePage.addEventListener('click', function () {
                if (!this.disabled) {
                    transitionToPage('agePage');
                }
            });

            document.getElementById('go2SurveyPage').addEventListener('click', function () {
                if (!this.disabled) {
                    clearInterval(timer);
                    collectTaskResponses();
                    transitionToPage('surveyPage');
                }
            });

            document.getElementById('submitButton').addEventListener('click', async function (event) {
                event.preventDefault();
                if (validateSurveyInputs()) {
                    collectTaskResponses();
                    collectSurveyResponses();
                    endTimer('surveyPage');
                    await downloadExperimentData();
                    sendToFirebase(experimentData);
                    if (document.fullscreenElement) {
                        document.exitFullscreen().then(() => {
                            console.log('Exited full-screen mode.');
                        }).catch((err) => {
                            console.error(`Error attempting to exit full-screen mode: ${err}`);
                        });
                    }
                    transitionToPage('endPage');
                }
            });

            const sendButtons = [
                { buttonId: 'sendGptPage', inputId: 'chatbotInputGptPage', displayId: 'chatDisplayGptPage' },
                { buttonId: 'sendTask', inputId: 'chatbotInputTask', displayId: 'chatDisplayTask' }
            ];

            const imageButtons = [
                { buttonId: 'imageGptPage', inputId: 'chatbotInputGptPage', displayId: 'chatDisplayGptPage' },
                { buttonId: 'imageTask', inputId: 'chatbotInputTask', displayId: 'chatDisplayTask' }
            ];

            sendButtons.forEach((buttonConfig) => {
                const button = document.getElementById(buttonConfig.buttonId);
                button.addEventListener('click', async () => {
                    const chatbotInput = document.getElementById(buttonConfig.inputId);
                    const chatDisplay = document.getElementById(buttonConfig.displayId);
                    const userMessage = chatbotInput?.value.trim();
                    if (userMessage) {
                        displayMessage(userMessage, 'user', chatDisplay, currentPage);
                        chatbotInput.value = '';
                        await callOpenAIAPI(userMessage, chatDisplay, currentPage);
                    }
                });
            });

            imageButtons.forEach((buttonConfig) => {
                const button = document.getElementById(buttonConfig.buttonId);
                button.addEventListener('click', async () => {
                    const chatbotInput = document.getElementById(buttonConfig.inputId);
                    const chatDisplay = document.getElementById(buttonConfig.displayId);
                    const userMessage = chatbotInput?.value.trim();
                    if (userMessage) {
                        displayMessage(userMessage, 'user', chatDisplay, currentPage);
                        chatbotInput.value = '';
                        await callDALLE3API(userMessage, chatDisplay, currentPage);
                    }
                });
            });

            function displayMessage(message, sender, chatDisplay, pageId) {
                if (!chatDisplay) return;

                const messageElement = document.createElement('div');
                messageElement.classList.add('message', sender);

                if (sender === 'bot' && message.startsWith('data:image')) {
                    const img = document.createElement('img');
                    img.src = message;
                    img.alt = 'Generated image';
                    messageElement.appendChild(img);
                } else {
                    messageElement.textContent = message;
                }

                chatDisplay.appendChild(messageElement);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;

                const messageData = { type: sender, content: message, timestamp: new Date().toISOString() };

                // Store messages in the correct page
                if (pageId === 'gptPage') {
                    experimentData.gptPage.messages.push(messageData);
                } else if (pageId === 'taskPage') {
                    experimentData.taskPage.messages.push(messageData);
                }
            }

            async function callOpenAIAPI(userMessage, chatDisplay, pageId) {
                try {
                    const apiKeySnapshot = await database.ref('apiKeys/openai').once('value');
                    const apiKey = apiKeySnapshot.val();

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "gpt-4",
                            messages: [
                                { "role": "system", "content": "You are a creative assistant. Please reply all questions with 100 words. For every idea you provided, please give detailed reasons for that." },
                                { "role": "user", "content": userMessage },
                            ],
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch from OpenAI API');
                    }

                    const data = await response.json();
                    const botResponse = data.choices[0].message.content.trim();
                    displayMessage(botResponse, 'bot', chatDisplay, pageId);
                } catch (error) {
                    console.error("Error calling the OpenAI API:", error);
                    displayMessage("Failed to get a response from the AI.", 'bot', chatDisplay, pageId);
                }
            }

            async function callDALLE3API(userMessage, chatDisplay, pageId) {
                try {
                    const apiKeySnapshot = await database.ref('apiKeys/openai').once('value');
                    const apiKey = apiKeySnapshot.val();

                    const response = await fetch('https://api.openai.com/v1/images/generations', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: "dall-e-3",
                            prompt: userMessage,
                            n: 1,
                            size: "1024x1024",
                            response_format: "b64_json"
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch from DALL-E 3 API');
                    }

                    const data = await response.json();
                    const imageData = data.data[0].b64_json;
                    const imageUrl = `data:image/png;base64,${imageData}`;
                    displayMessage(imageUrl, 'bot', chatDisplay, pageId);

                } catch (error) {
                    console.error("Error calling the DALL-E 3 API:", error);
                    displayMessage("Failed to generate an image.", 'bot', chatDisplay, pageId);
                }
            }

            let countdownIntervals = {};

            function startCountdown(duration, displayElementId) {
                var timer = duration, minutes, seconds;
                var countdownInterval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    document.getElementById(displayElementId).textContent = `Time left: ${minutes}:${seconds}`;

                    if (--timer < 0) {
                        clearInterval(countdownInterval);
                        if (currentPage === 'autPage') {
                            showModal(() => transitionToPage('beforeTaskPage'));
                        } else {
                            transitionToNextPage();
                        }
                    }
                }, 1000);
                countdownIntervals[displayElementId] = countdownInterval;
            }

            function setContentBasedOnCondition() {
                const [aiOrHm, wordPair, designGoal] = experimentData.conditionID.split('-');

                const taskChatbot = document.getElementById('taskLeftside');
                const taskRightside = document.getElementById('taskRightside');
                const beforeTaskInstructions = document.querySelector('#beforeTaskPage ul');

                const existingNoAIToolsLi = beforeTaskInstructions.querySelector('li:last-child');
                if (existingNoAIToolsLi && existingNoAIToolsLi.textContent.includes('No Generative AI Tools')) {
                    existingNoAIToolsLi.remove();
                }

                if (aiOrHm === 'HM') {
                    const newLi = document.createElement('li');
                    newLi.style.marginBottom = '15px';
                    newLi.style.textAlign = 'left';
                    newLi.innerHTML = `<span style="color: #d9534f; font-weight: bold;">✗ No Generative AI Tools:</span> You must not use
        any generative AI tools, such as ChatGPT, to complete this task. Your work will be subjected to
        AI detection. If AI usage is detected, you will not receive payment.`;
                    beforeTaskInstructions.appendChild(newLi);
                }

                if (aiOrHm === 'HM') {
                    taskChatbot.style.display = 'none';
                    taskRightside.style.margin = '0 auto';
                } else {
                    taskChatbot.style.display = 'flex';
                    taskRightside.style.margin = '';
                }

                const speedComparisonQuestion = document.querySelector('label[for="gpt_speed_comparison"]');
                const noveltyComparisonQuestion = document.querySelector('label[for="gpt_novelty_comparison"]');
                if (aiOrHm === 'HM') {
                    speedComparisonQuestion.textContent = "How much faster did you complete the task compared to how long it would have taken with generative AI tools?";
                    noveltyComparisonQuestion.textContent = "How much better in idea novelty did you complete the ideation task compared to how this task would have been with generative AI tools?";
                } else {
                    speedComparisonQuestion.textContent = "How much faster did you complete the task compared to how long it would have taken without generative AI tools?";
                    noveltyComparisonQuestion.textContent = "How much better in idea novelty did you complete the ideation task compared to how this task would have been without generative AI tools?";
                }

                let word1, word2;
                switch (wordPair) {
                    case 'NL':
                        word1 = 'Car';
                        word2 = 'Bicycle';
                        break;
                    case 'NH':
                        word1 = 'Mobility';
                        word2 = 'Portability';
                        break;
                    case 'RL':
                        word1 = 'Car';
                        word2 = 'Laptop';
                        break;
                    case 'RH':
                        word1 = 'Mobility';
                        word2 = 'Deduction';
                        break;
                }

                let goal = designGoal === 'UT' ? 'help children increase their cognitive ability' : 'help children to have fun';

                const taskInstructions = document.getElementById('taskInstructions');
                taskInstructions.innerHTML = `
    <div style="line-height: 1.6; font-size: 16px;">
        <span style="display: inline-block; margin-bottom: 15px; background-color: #F7CE5D; color: #000000; font-weight: bold; padding: 2px 5px; border-radius: 3px; font-size: 1.2em;">TASK:</span>
            Please design a toy, anything a child (age 5–11) can use to play with, by combining these two concepts:
            <span style="color: #d9534f; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">${word1}</span> and 
            <span style="color: #d9534f; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">${word2}</span>. 
        <p style="margin-bottom: 15px;">
            The design goal is to 
            <span style="color: #d9534f; font-weight: bold; font-size: 1.2em; background-color: #FFE6E6; padding: 2px 5px; border-radius: 3px;">${goal}</span>.
        </p>
        <ul style="padding-left: 20px; margin-top: 20px;">
            <li style="margin-bottom: 10px;">Your ideation should disregard production cost.</li>
            <li style="margin-bottom: 10px;">Submit at least three ideas and give a description for each idea with at least 20 words.</li>
        </ul>
    </div>
`;
            }

            function transitionToPage(pageName) {
                if (countdownIntervals[currentPage]) {
                    clearInterval(countdownIntervals[currentPage]);
                    delete countdownIntervals[currentPage];
                }

                endTimer(currentPage);
                document.getElementById(currentPage).style.display = 'none';
                document.getElementById(pageName).style.display = 'flex';

                document.querySelectorAll('[id^="uniqueIndexDisplay-"]').forEach(display => {
                    display.style.display = 'none';
                });
                document.getElementById(`uniqueIndexDisplay-${pageName}`).style.display = 'block';

                currentPage = pageName;
                startTimer(pageName);

                switch (pageName) {
                    case 'gptPage':
                        sendPredefinedGptMessage();
                        break;
                    case 'agePage':
                        startAutButtonCountdown();
                        break;
                    case 'autPage':
                        startCountdown(30, 'autCountdown');
                        break;
                    case 'beforeTaskPage':
                        startTaskButtonCountdown();
                        setContentBasedOnCondition();
                        break;
                    case 'taskPage':
                        setContentBasedOnCondition();
                        startTaskTimer();
                        displayGreetingMessage();
                        break;
                    case 'surveyPage':
                        setContentBasedOnCondition();
                        addIdeaRatings();
                        break;
                }
            }

            function transitionToNextPage() {
                const nextPageFunction = function () {
                    if (currentPage === 'gptPage') {
                        transitionToPage('taskPage');
                    } else if (currentPage === 'taskPage') {
                        transitionToPage('surveyPage');
                    } else {
                        transitionToPage('endPage');
                    }
                };

                showModal(nextPageFunction);
            }

            function showModal(nextPageFunction) {
                var modal = document.getElementById('modal');
                var closeModal = document.getElementById('closeModal');
                modal.style.display = 'flex';

                closeModal.onclick = function () {
                    modal.style.display = 'none';
                    nextPageFunction();
                };
            }

            function startTimer(pageName) {
                const startTime = new Date();
                experimentData.pageTimings[pageName] = { start: startTime.getTime(), startReadable: startTime.toLocaleString() };
            }

            function endTimer(pageName) {
                const endTime = new Date();
                if (experimentData.pageTimings[pageName] && experimentData.pageTimings[pageName].start) {
                    const startTime = experimentData.pageTimings[pageName].start;
                    const timeSpent = Math.floor((endTime.getTime() - startTime) / 1000);
                    experimentData.pageTimings[pageName].end = endTime.getTime();
                    experimentData.pageTimings[pageName].endReadable = endTime.toLocaleString();
                    experimentData.pageTimings[pageName].timeSpentSeconds = timeSpent;
                }
            }

            function validateSurveyInputs() {
                let isValid = true;
                let errorMessages = [];
                const surveyForm = document.getElementById('surveyForm');
                const inputs = surveyForm.querySelectorAll('input, select');
                let rangeInputChanged = false;

                inputs.forEach(input => {
                    if (input.required && !input.value.trim()) {
                        isValid = false;
                        const label = input.closest('.form-group').querySelector('label').textContent.replace(':', '');
                        errorMessages.push(`Please finish this question: ${label}`);
                    }
                });

                const rangeInputs = surveyForm.querySelectorAll('input[type="range"]');
                rangeInputs.forEach(input => {
                    if (input.value !== '4') {
                        rangeInputChanged = true;
                    }
                });

                if (!rangeInputChanged) {
                    isValid = false;
                    errorMessages.push('Please adjust at least one rating bar.');
                }

                const errorSurvey = document.getElementById('errorSurvey');
                if (!isValid) {
                    errorSurvey.innerHTML = errorMessages.join('<br>');
                    errorSurvey.style.display = 'block';
                } else {
                    errorSurvey.style.display = 'none';
                }

                return isValid;
            }

            function collectSurveyResponses() {
                const surveyForm = document.getElementById('surveyForm');
                const formData = new FormData(surveyForm);
                for (let [key, value] of formData.entries()) {
                    experimentData.surveyPage.responses[key] = value;
                }
            }

            function addAnswerField() {
                const answersContainer = document.getElementById('autAnswers');
                const newAnswer = document.createElement('textarea');
                newAnswer.className = 'autAnswer';
                newAnswer.placeholder = 'Enter a novel use for a paper clip';
                newAnswer.addEventListener('input', function () {
                    experimentData.autPage.ideas = Array.from(document.querySelectorAll('.autAnswer')).map(textarea => textarea.value);
                });
                answersContainer.appendChild(newAnswer);
            }

            document.getElementById('addAnswerButton').addEventListener('click', addAnswerField);

            const ageInput = document.getElementById('ageInput');
            ageInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/[^0-9]/g, '');
                let value = parseInt(this.value);
                if (value < 1) this.value = '1';
                if (value > 120) this.value = '120';
                experimentData.agePage.age = this.value;
            });

            ageInput.addEventListener('keydown', function (e) {
                if ([46, 8, 9, 27, 13, 110].indexOf(e.keyCode) !== -1 ||
                    (e.keyCode === 65 && e.ctrlKey === true) ||
                    (e.keyCode === 67 && e.ctrlKey === true) ||
                    (e.keyCode === 86 && e.ctrlKey === true) ||
                    (e.keyCode === 88 && e.ctrlKey === true) ||
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    return;
                }
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });

            const ideaInputs = document.getElementById('ideaInputs');
            const addIdeaButton = document.getElementById('addIdeaButton');
            const go2SurveyPage = document.getElementById('go2SurveyPage');
            const errorTask = document.getElementById('errorTask');
            const addIdeaError = document.getElementById('addIdeaError');

            let timer;
            let timerComplete = false;

            function validateFirstThreeIdeas() {
                const textareas = document.querySelectorAll('#ideaInputs .reasonarea');
                if (textareas.length < 3) return false;

                for (let i = 0; i < 3; i++) {
                    const wordCount = getWordCount(textareas[i].value);
                    if (wordCount < 20) return false;
                }
                return true;
            }

            function addIdeaField() {
                if (!validateFirstThreeIdeas()) {
                    addIdeaError.textContent = "Please finish the first three ideas before adding more ideas.";
                    return;
                }

                addIdeaError.textContent = "";

                const newIdeaContainer = document.createElement('div');
                newIdeaContainer.className = 'ideaContainer';
                newIdeaContainer.innerHTML = `
<textarea class="reasonarea" placeholder="Enter your description here..."></textarea>
<div class="wordCount">Word Count: 0</div>
`;
                ideaInputs.appendChild(newIdeaContainer);
                updateWordCount(newIdeaContainer.querySelector('.reasonarea'), newIdeaContainer.querySelector('.wordCount'));

                const ideasContainer = document.getElementById('ideasContainer');
                ideasContainer.scrollTop = ideasContainer.scrollHeight;

                updateTaskPageIdeas();
            }

            function updateTaskPageIdeas() {
                experimentData.taskPage.ideas = Array.from(document.querySelectorAll('#ideaInputs .reasonarea')).map(textarea => textarea.value);
            }

            function validateSubmission() {
                const textareas = document.querySelectorAll('#ideaInputs .reasonarea');
                let isValid = true;

                if (textareas.length < 3) {
                    isValid = false;
                } else {
                    for (let i = 0; i < 3; i++) {
                        const wordCount = getWordCount(textareas[i].value);
                        if (textareas[i].value.trim() === '' || wordCount < 20) {
                            isValid = false;
                            break;
                        }
                    }
                }

                const errorTask = document.getElementById('errorTask');
                errorTask.style.display = isValid ? 'none' : 'inline';
                go2SurveyPage.disabled = !(timerComplete && isValid);

                if (timerComplete) {
                    go2SurveyPage.textContent = isValid ? 'Next' : 'Complete All Tasks';
                }
            }

            function startTaskTimer() {
                let timeLeft = 300; // 5 minutes in seconds
                go2SurveyPage.disabled = true;

                timer = setInterval(() => {
                    timeLeft--;
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    go2SurveyPage.textContent = `Submit (Clickable in ${minutes}:${seconds.toString().padStart(2, '0')})`;

                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        timerComplete = true;
                        go2SurveyPage.textContent = 'Next';
                        validateSubmission();
                    }
                }, 1000);
            }

            function updateWordCount(textarea, wordCountElement) {
                textarea.addEventListener('input', function () {
                    const text = textarea.value.trim();
                    let count;

                    if (/[\u4e00-\u9fa5]/.test(text)) {
                        count = text.replace(/[^\u4e00-\u9fa5]/g, '').length;
                    } else {
                        count = text.split(/\s+/).filter(word => word.length > 0).length;
                    }

                    wordCountElement.textContent = `Word Count: ${count}`;
                    if (currentPage === 'taskPage' && timerComplete) {
                        validateSubmission();
                    }

                    if (validateFirstThreeIdeas()) {
                        addIdeaError.textContent = "";
                    }

                    updateTaskPageIdeas();
                });
            }

            function collectTaskResponses() {
                const ideas = [];
                document.querySelectorAll('#ideaInputs .reasonarea').forEach((textarea, index) => {
                    ideas.push({
                        idea: index + 1,
                        description: textarea.value.trim(),
                        wordCount: getWordCount(textarea.value)
                    });
                });
                experimentData.taskPage.ideas = ideas;
            }

            addIdeaButton.addEventListener('click', addIdeaField);

            document.querySelectorAll('#ideaInputs .reasonarea').forEach(textarea => {
                updateWordCount(textarea, textarea.nextElementSibling);
            });

            function addIdeaRatings() {
                const ideaRatingsContainer = document.getElementById('ideaRatingsContainer');
                ideaRatingsContainer.innerHTML = '';

                const ideas = experimentData.taskPage.ideas;

                ideas.forEach((idea, index) => {
                    const ideaRatingDiv = document.createElement('div');
                    ideaRatingDiv.className = 'idea-rating-row';

                    const aspectsToRate = [
                        { name: 'originality', label: 'original' },
                        { name: 'innovativeness', label: 'innovative' },
                        { name: 'novelty', label: 'novel' },
                        { name: 'practicality', label: 'practical' },
                        { name: 'effectiveness', label: 'effective' },
                        { name: 'usefulness', label: 'useful' }
                    ];

                    let ideaHtml = `
<div class="idea-column">
<h4>Idea ${index + 1}</h4>
<p>${idea.description}</p>
</div>
<div class="ratings-column">
`;

                    aspectsToRate.forEach(aspect => {
                        ideaHtml += `
<div class="rating-row">
    <span class="range-label left">Not at all ${aspect.label}</span>
    <input type="range" id="idea${index + 1}-${aspect.name}" name="idea${index + 1}-${aspect.name}" 
           min="1" max="7" value="4" required>
    <span class="range-label right">Very ${aspect.label}</span>
    <span class="range-value">4</span>
</div>
`;
                    });

                    ideaHtml += `</div>`;
                    ideaRatingDiv.innerHTML = ideaHtml;
                    ideaRatingsContainer.appendChild(ideaRatingDiv);
                });

                document.querySelectorAll('.ratings-column input[type="range"]').forEach(input => {
                    input.addEventListener('input', function () {
                        this.nextElementSibling.nextElementSibling.textContent = this.value;
                    });
                });
            }

            async function updateAndGetReceivedID() {
                const ref = database.ref('receivedID');
                const snapshot = await ref.once('value');
                const currentID = snapshot.val() || 0;
                const newID = currentID + 1;
                await ref.set(newID);
                experimentData.receivedID = newID;
                return newID;
            }

            function determineConditionID(receivedID) {
                const conditions = [
                    'HM-NL-UT', 'HM-NH-UT', 'HM-RL-UT', 'HM-RH-UT',
                    'HM-NL-HD', 'HM-NH-HD', 'HM-RL-HD', 'HM-RH-HD',
                    'AI-NL-UT', 'AI-NH-UT', 'AI-RL-UT', 'AI-RH-UT',
                    'AI-NL-HD', 'AI-NH-HD', 'AI-RL-HD', 'AI-RH-HD'
                ];
                const conditionID = conditions[(receivedID - 1) % 16];
                experimentData.conditionID = conditionID;
                return conditionID;
            }

            function generateUniqueIndex(conditionID) {
                const conditionIDNoDash = conditionID.replace(/-/g, '');
                const now = new Date();
                const startDate = now.getFullYear().toString() +
                    (now.getMonth() + 1).toString().padStart(2, '0') +
                    now.getDate().toString().padStart(2, '0');
                const startTime = now.getHours().toString().padStart(2, '0') +
                    now.getMinutes().toString().padStart(2, '0');
                const uniqueID = Math.random().toString(36).substring(2, 8).toUpperCase();
                const uniqueIndex = `${receivedID}-V${conditionIDNoDash}${startDate}${startTime}${uniqueID}`;
                experimentData.uniqueIndex = uniqueIndex;
                return uniqueIndex;
            }

            function addUniqueIndexDisplay() {
                const pages = ['welcomePage', 'gptPage', 'agePage', 'autPage', 'beforeTaskPage', 'taskPage', 'surveyPage', 'endPage'];
                pages.forEach(pageId => {
                    const page = document.getElementById(pageId);
                    const uniqueIndexDisplay = document.createElement('div');
                    uniqueIndexDisplay.id = `uniqueIndexDisplay-${pageId}`;
                    uniqueIndexDisplay.style.position = 'fixed';
                    uniqueIndexDisplay.style.bottom = '10px';
                    uniqueIndexDisplay.style.right = '10px';
                    uniqueIndexDisplay.style.color = '#cccccc';
                    uniqueIndexDisplay.style.fontSize = '12px';
                    uniqueIndexDisplay.style.zIndex = '1000';
                    page.appendChild(uniqueIndexDisplay);
                });
            }

            function downloadExperimentData() {
                const jsonString = JSON.stringify(experimentData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${experimentData.uniqueIndex}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            validateGptPage();

            document.addEventListener('DOMContentLoaded', async (event) => {
                transitionToPage('welcomePage');
            });
        });
    </script>

</body>

</html>
